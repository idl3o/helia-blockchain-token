(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ChainsafeLibp2PNoise = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ChainsafeLibp2PNoise=(()=>{var pn=Object.defineProperty;var qa=Object.getOwnPropertyDescriptor;var Va=Object.getOwnPropertyNames;var Fa=Object.prototype.hasOwnProperty;var Et=(r,t)=>{for(var e in t)pn(r,e,{get:t[e],enumerable:!0})},za=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Va(t))!Fa.call(r,o)&&o!==e&&pn(r,o,{get:()=>t[o],enumerable:!(n=qa(t,o))||n.enumerable});return r};var Ga=r=>za(pn({},"__esModule",{value:!0}),r);var lh={};Et(lh,{noise:()=>hh,pureJsCrypto:()=>un});var mn=Symbol.for("@libp2p/peer-id");var br=class extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}},wr=class extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}},ot=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},we=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var Ee=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var ws=Symbol.for("@libp2p/service-capabilities"),yh=Symbol.for("@libp2p/service-dependencies");var wn={};Et(wn,{base58btc:()=>nt,base58flickr:()=>$a});var Oh=new Uint8Array(0);function Es(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function kt(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Ss(r){return new TextEncoder().encode(r)}function As(r){return new TextDecoder().decode(r)}function ja(r,t){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=o}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function l(w){if(w instanceof Uint8Array||(ArrayBuffer.isView(w)?w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength):Array.isArray(w)&&(w=Uint8Array.from(w))),!(w instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length===0)return"";for(var m=0,h=0,g=0,b=w.length;g!==b&&w[g]===0;)g++,m++;for(var d=(b-g)*f+1>>>0,v=new Uint8Array(d);g!==b;){for(var R=w[g],K=0,I=d-1;(R!==0||K<h)&&I!==-1;I--,K++)R+=256*v[I]>>>0,v[I]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");h=K,g++}for(var T=d-h;T!==d&&v[T]===0;)T++;for(var B=c.repeat(m);T<d;++T)B+=r.charAt(v[T]);return B}function p(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return new Uint8Array;var m=0;if(w[m]!==" "){for(var h=0,g=0;w[m]===c;)h++,m++;for(var b=(w.length-m)*u+1>>>0,d=new Uint8Array(b);w[m];){var v=e[w.charCodeAt(m)];if(v===255)return;for(var R=0,K=b-1;(v!==0||R<g)&&K!==-1;K--,R++)v+=a*d[K]>>>0,d[K]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=R,m++}if(w[m]!==" "){for(var I=b-g;I!==b&&d[I]===0;)I++;for(var T=new Uint8Array(h+(b-I)),B=h;I!==b;)T[B++]=d[I++];return T}}}function S(w){var m=p(w);if(m)return m;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:p,decode:S}}var Za=ja,Ya=Za,Bs=Ya;var yn=class{name;prefix;baseEncode;constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},xn=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,n){this.name=t,this.prefix=e;let o=e.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ls(this,t)}},gn=class{decoders;constructor(t){this.decoders=t}or(t){return Ls(this,t)}decode(t){let e=t[0],n=this.decoders[e];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Ls(r,t){return new gn({...r.decoders??{[r.prefix]:r},...t.decoders??{[t.prefix]:t}})}var bn=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,n,o){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=o,this.encoder=new yn(t,e,n),this.decoder=new xn(t,e,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Se({name:r,prefix:t,encode:e,decode:n}){return new bn(r,t,e,n)}function jt({name:r,prefix:t,alphabet:e}){let{encode:n,decode:o}=Bs(e,r);return Se({prefix:t,name:r,encode:n,decode:s=>kt(o(s))})}function Wa(r,t,e,n){let o={};for(let f=0;f<t.length;++f)o[t[f]]=f;let s=r.length;for(;r[s-1]==="=";)--s;let i=new Uint8Array(s*e/8|0),a=0,c=0,u=0;for(let f=0;f<s;++f){let l=o[r[f]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<e|l,a+=e,a>=8&&(a-=8,i[u++]=255&c>>a)}if(a>=e||(255&c<<8-a)!==0)throw new SyntaxError("Unexpected end of data");return i}function Xa(r,t,e){let n=t[t.length-1]==="=",o=(1<<e)-1,s="",i=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],i+=8;i>e;)i-=e,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<e-i]),n)for(;(s.length*e&7)!==0;)s+="=";return s}function rt({name:r,prefix:t,bitsPerChar:e,alphabet:n}){return Se({prefix:t,name:r,encode(o){return Xa(o,n,e)},decode(o){return Wa(o,n,e,r)}})}var nt=jt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),$a=jt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var En={};Et(En,{base32:()=>Ae,base32hex:()=>ec,base32hexpad:()=>nc,base32hexpadupper:()=>oc,base32hexupper:()=>rc,base32pad:()=>Qa,base32padupper:()=>tc,base32upper:()=>Ja,base32z:()=>sc});var Ae=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ja=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qa=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),tc=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ec=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),rc=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nc=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oc=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),sc=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Sn={};Et(Sn,{base36:()=>Ge,base36upper:()=>ic});var Ge=jt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ic=jt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ac=Cs,_s=128,cc=127,fc=~cc,uc=Math.pow(2,31);function Cs(r,t,e){t=t||[],e=e||0;for(var n=e;r>=uc;)t[e++]=r&255|_s,r/=128;for(;r&fc;)t[e++]=r&255|_s,r>>>=7;return t[e]=r|0,Cs.bytes=e-n+1,t}var hc=An,lc=128,Is=127;function An(r,n){var e=0,n=n||0,o=0,s=n,i,a=r.length;do{if(s>=a)throw An.bytes=0,new RangeError("Could not decode varint");i=r[s++],e+=o<28?(i&Is)<<o:(i&Is)*Math.pow(2,o),o+=7}while(i>=lc);return An.bytes=s-n,e}var dc=Math.pow(2,7),pc=Math.pow(2,14),mc=Math.pow(2,21),yc=Math.pow(2,28),xc=Math.pow(2,35),gc=Math.pow(2,42),bc=Math.pow(2,49),wc=Math.pow(2,56),Ec=Math.pow(2,63),Sc=function(r){return r<dc?1:r<pc?2:r<mc?3:r<yc?4:r<xc?5:r<gc?6:r<bc?7:r<wc?8:r<Ec?9:10},Ac={encode:ac,decode:hc,encodingLength:Sc},vc=Ac,je=vc;function Ze(r,t=0){return[je.decode(r,t),je.decode.bytes]}function ve(r,t,e=0){return je.encode(r,t,e),t}function Be(r){return je.encodingLength(r)}function _t(r,t){let e=t.byteLength,n=Be(r),o=n+Be(e),s=new Uint8Array(o+e);return ve(r,s,0),ve(e,s,n),s.set(t,o),new Le(r,e,t,s)}function vn(r){let t=kt(r),[e,n]=Ze(t),[o,s]=Ze(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new Le(e,o,i,t)}function Ts(r,t){if(r===t)return!0;{let e=t;return r.code===e.code&&r.size===e.size&&e.bytes instanceof Uint8Array&&Es(r.bytes,e.bytes)}}var Le=class{code;size;digest;bytes;constructor(t,e,n,o){this.code=t,this.size=e,this.digest=n,this.bytes=o}};function Ks(r,t){let{bytes:e,version:n}=r;switch(n){case 0:return Lc(e,Bn(r),t??nt.encoder);default:return _c(e,Bn(r),t??Ae.encoder)}}var Us=new WeakMap;function Bn(r){let t=Us.get(r);if(t==null){let e=new Map;return Us.set(r,e),e}return t}var dt=class r{code;version;multihash;bytes;"/";constructor(t,e,n,o){this.code=e,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:e}=this;if(t!==Ye)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==Ic)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:e}=this.multihash,n=_t(t,e);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return r.equals(this,t)}static equals(t,e){let n=e;return n!=null&&t.code===n.code&&t.version===n.version&&Ts(t.multihash,n.multihash)}toString(t){return Ks(this,t)}toJSON(){return{"/":Ks(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let e=t;if(e instanceof r)return e;if(e["/"]!=null&&e["/"]===e.bytes||e.asCID===e){let{version:n,code:o,multihash:s,bytes:i}=e;return new r(n,o,s,i??Rs(n,o,s.bytes))}else if(e[Cc]===!0){let{version:n,multihash:o,code:s}=e,i=vn(o);return r.create(n,s,i)}else return null}static create(t,e,n){if(typeof e!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(e!==Ye)throw new Error(`Version 0 CID must use dag-pb (code: ${Ye}) block encoding`);return new r(t,e,n,n.bytes)}case 1:{let o=Rs(t,e,n.bytes);return new r(t,e,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return r.create(0,Ye,t)}static createV1(t,e){return r.create(1,t,e)}static decode(t){let[e,n]=r.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return e}static decodeFirst(t){let e=r.inspectBytes(t),n=e.size-e.multihashSize,o=kt(t.subarray(n,n+e.multihashSize));if(o.byteLength!==e.multihashSize)throw new Error("Incorrect length");let s=o.subarray(e.multihashSize-e.digestSize),i=new Le(e.multihashCode,e.digestSize,s,o);return[e.version===0?r.createV0(i):r.createV1(e.codec,i),t.subarray(e.size)]}static inspectBytes(t){let e=0,n=()=>{let[l,p]=Ze(t.subarray(e));return e+=p,l},o=n(),s=Ye;if(o===18?(o=0,e=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=e,a=n(),c=n(),u=e+c,f=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:u}}static parse(t,e){let[n,o]=Bc(t,e),s=r.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Bn(s).set(n,t),s}};function Bc(r,t){switch(r[0]){case"Q":{let e=t??nt;return[nt.prefix,e.decode(`${nt.prefix}${r}`)]}case nt.prefix:{let e=t??nt;return[nt.prefix,e.decode(r)]}case Ae.prefix:{let e=t??Ae;return[Ae.prefix,e.decode(r)]}case Ge.prefix:{let e=t??Ge;return[Ge.prefix,e.decode(r)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],t.decode(r)]}}}function Lc(r,t,e){let{prefix:n}=e;if(n!==nt.prefix)throw Error(`Cannot string encode V0 in ${e.name} encoding`);let o=t.get(n);if(o==null){let s=e.encode(r).slice(1);return t.set(n,s),s}else return o}function _c(r,t,e){let{prefix:n}=e,o=t.get(n);if(o==null){let s=e.encode(r);return t.set(n,s),s}else return o}var Ye=112,Ic=18;function Rs(r,t,e){let n=Be(r),o=n+Be(t),s=new Uint8Array(o+e.byteLength);return ve(r,s,0),ve(t,s,n),s.set(e,o),s}var Cc=Symbol.for("@ipld/js-cid/CID");var Ln={};Et(Ln,{identity:()=>Rt});var Ps=0,Tc="identity",Ds=kt;function Kc(r){return _t(Ps,Ds(r))}var Rt={code:Ps,name:Tc,encode:Ds,digest:Kc};function gt(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function st(r=0){return new Uint8Array(r)}function it(r=0){return new Uint8Array(r)}function ie(r,t){t==null&&(t=r.reduce((o,s)=>o+s.length,0));let e=it(t),n=0;for(let o of r)e.set(o,n),n+=o.length;return e}var ks=Symbol.for("@achingbrain/uint8arraylist");function Ns(r,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let e=0;for(let n of r){let o=e+n.byteLength;if(t<o)return{buf:n,index:t-e};e=o}throw new RangeError("index is out of bounds")}function Sr(r){return!!r?.[ks]}var Z=class r{bufs;length;[ks]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(let n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else if(Sr(n))e+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(let n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else if(Sr(n))e+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}get(t){let e=Ns(this.bufs,t);return e.buf[e.index]}set(t,e){let n=Ns(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else if(Sr(t))for(let n=0;n<t.length;n++)this.set(e+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,e){let{bufs:n,length:o}=this._subList(t,e);return ie(n,o)}subarray(t,e){let{bufs:n,length:o}=this._subList(t,e);return n.length===1?n[0]:ie(n,o)}sublist(t,e){let{bufs:n,length:o}=this._subList(t,e),s=new r;return s.length=o,s.bufs=[...n],s}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(t===0&&e===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let u=t>=a&&t<c,f=e>a&&e<=c;if(u&&f){if(t===a&&e===c){n.push(i);break}let l=t-a;n.push(i.subarray(l,l+(e-t)));break}if(u){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(f){if(e===c){n.push(i);break}n.push(i.subarray(0,e-a));break}n.push(i)}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!Sr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let a=i,c=this.byteLength-n.byteLength,u=n.byteLength-1,f;for(let l=e;l<=c;l+=f){f=0;for(let p=u;p>=0;p--){let S=this.get(l+p);if(n[p]!==S){f=Math.max(1,p-a[S]);break}}if(f===0)return l}return-1}getInt8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){let n=it(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,e),this.write(n,t)}getInt16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,e)}setInt16(t,e,n){let o=st(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,e,n),this.write(o,t)}getInt32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,e)}setInt32(t,e,n){let o=st(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,e,n),this.write(o,t)}getBigInt64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,e)}setBigInt64(t,e,n){let o=st(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,e,n),this.write(o,t)}getUint8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){let n=it(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,e),this.write(n,t)}getUint16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,e)}setUint16(t,e,n){let o=st(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,e,n),this.write(o,t)}getUint32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,e)}setUint32(t,e,n){let o=st(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,e,n),this.write(o,t)}getBigUint64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,e)}setBigUint64(t,e,n){let o=st(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,e,n),this.write(o,t)}getFloat32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,e)}setFloat32(t,e,n){let o=st(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,e,n),this.write(o,t)}getFloat64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,e)}setFloat64(t,e,n){let o=st(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,e,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof r)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!gt(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){let n=new r;return n.bufs=t,e==null&&(e=t.reduce((o,s)=>o+s.byteLength,0)),n.length=e,n}};var _n={};Et(_n,{base10:()=>Rc});var Rc=jt({prefix:"9",name:"base10",alphabet:"0123456789"});var In={};Et(In,{base16:()=>Pc,base16upper:()=>Dc});var Pc=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Dc=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Cn={};Et(Cn,{base2:()=>Nc});var Nc=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Tn={};Et(Tn,{base256emoji:()=>qc});var Ms=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),kc=Ms.reduce((r,t,e)=>(r[e]=t,r),[]),Mc=Ms.reduce((r,t,e)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return r[n]=e,r},[]);function Oc(r){return r.reduce((t,e)=>(t+=kc[e],t),"")}function Hc(r){let t=[];for(let e of r){let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);let o=Mc[n];if(o==null)throw new Error(`Non-base256emoji character: ${e}`);t.push(o)}return new Uint8Array(t)}var qc=Se({prefix:"\u{1F680}",name:"base256emoji",encode:Oc,decode:Hc});var Kn={};Et(Kn,{base64:()=>Vc,base64pad:()=>Fc,base64url:()=>zc,base64urlpad:()=>Gc});var Vc=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fc=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zc=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Gc=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Un={};Et(Un,{base8:()=>jc});var jc=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Rn={};Et(Rn,{identity:()=>Zc});var Zc=Se({prefix:"\0",name:"identity",encode:r=>As(r),decode:r=>Ss(r)});var El=new TextEncoder,Sl=new TextDecoder;var Nn={};Et(Nn,{sha256:()=>Ar,sha512:()=>Xc});function Dn({name:r,code:t,encode:e}){return new Pn(r,t,e)}var Pn=class{name;code;encode;constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){let e=this.encode(t);return e instanceof Uint8Array?_t(this.code,e):e.then(n=>_t(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Hs(r){return async t=>new Uint8Array(await crypto.subtle.digest(r,t))}var Ar=Dn({name:"sha2-256",code:18,encode:Hs("SHA-256")}),Xc=Dn({name:"sha2-512",code:19,encode:Hs("SHA-512")});var kn={...Rn,...Cn,...Un,..._n,...In,...En,...Sn,...wn,...Kn,...Tn},Pl={...Nn,...Ln};function Vs(r,t,e,n){return{name:r,prefix:t,encoder:{name:r,prefix:t,encode:e},decoder:{decode:n}}}var qs=Vs("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Mn=Vs("ascii","a",r=>{let t="a";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t},r=>{r=r.substring(1);let t=it(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}),$c={utf8:qs,"utf-8":qs,hex:kn.base16,latin1:Mn,ascii:Mn,binary:Mn,...kn},vr=$c;function $(r,t="utf8"){let e=vr[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.decoder.decode(`${e.prefix}${r}`)}function G(r,t="utf8"){let e=vr[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.encoder.encode(r).substring(1)}var Jc=parseInt("11111",2),On=parseInt("10000000",2),Qc=parseInt("01111111",2),Fs={0:We,1:We,2:tf,3:nf,4:of,5:rf,6:ef,16:We,22:We,48:We};function Mt(r,t={offset:0}){let e=r[t.offset]&Jc;if(t.offset++,Fs[e]!=null)return Fs[e](r,t);throw new Error("No decoder for tag "+e)}function Xe(r,t){let e=0;if((r[t.offset]&On)===On){let n=r[t.offset]&Qc,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=r[t.offset].toString(16).padStart(2,"0");e=parseInt(o,16)}else e=r[t.offset],t.offset++;return e}function We(r,t){Xe(r,t);let e=[];for(;!(t.offset>=r.byteLength);){let n=Mt(r,t);if(n===null)break;e.push(n)}return e}function tf(r,t){let e=Xe(r,t),n=t.offset,o=t.offset+e,s=[];for(let i=n;i<o;i++)i===n&&r[i]===0||s.push(r[i]);return t.offset+=e,Uint8Array.from(s)}function ef(r,t){let e=Xe(r,t),n=t.offset+e,o=r[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let a=`${s}.${i}`,c=[];for(;t.offset<n;){let u=r[t.offset];if(t.offset++,c.push(u&127),u<128){c.reverse();let f=0;for(let l=0;l<c.length;l++)f+=c[l]<<l*7;a+=`.${f}`,c=[]}}return a}function rf(r,t){return t.offset++,null}function nf(r,t){let e=Xe(r,t),n=r[t.offset];t.offset++;let o=r.subarray(t.offset,t.offset+e-1);if(t.offset+=e,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function of(r,t){let e=Xe(r,t),n=r.subarray(t.offset,t.offset+e);return t.offset+=e,n}function sf(r){let t=r.toString(16);t.length%2===1&&(t="0"+t);let e=new Z;for(let n=0;n<t.length;n+=2)e.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return e}function Hn(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let t=sf(r.byteLength);return new Z(Uint8Array.from([t.byteLength|On]),t)}function St(r){let t=new Z,e=128;return(r.subarray()[0]&e)===e&&t.append(Uint8Array.from([0])),t.append(r),new Z(Uint8Array.from([2]),Hn(t),t)}function Br(r){let t=Uint8Array.from([0]),e=new Z(t,r);return new Z(Uint8Array.from([3]),Hn(e),e)}function Zt(r,t=48){let e=new Z;for(let n of r)e.append(n);return new Z(Uint8Array.from([t]),Hn(e),e)}async function zs(r,t,e){let n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,t,e.subarray())}var af=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),cf=Uint8Array.from([6,5,43,129,4,0,34]),ff=Uint8Array.from([6,5,43,129,4,0,35]),uf={ext:!0,kty:"EC",crv:"P-256"},hf={ext:!0,kty:"EC",crv:"P-384"},lf={ext:!0,kty:"EC",crv:"P-521"},qn=32,Vn=48,Fn=66;function Gs(r){let t=Mt(r);return js(t)}function js(r){let t=r[1][1][0],e=1,n,o;if(t.byteLength===qn*2+1)return n=G(t.subarray(e,e+qn),"base64url"),o=G(t.subarray(e+qn),"base64url"),new Ie({...uf,key_ops:["verify"],x:n,y:o});if(t.byteLength===Vn*2+1)return n=G(t.subarray(e,e+Vn),"base64url"),o=G(t.subarray(e+Vn),"base64url"),new Ie({...hf,key_ops:["verify"],x:n,y:o});if(t.byteLength===Fn*2+1)return n=G(t.subarray(e,e+Fn),"base64url"),o=G(t.subarray(e+Fn),"base64url"),new Ie({...lf,key_ops:["verify"],x:n,y:o});throw new ot(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function Zs(r){return Zt([St(Uint8Array.from([1])),Zt([df(r.crv)],160),Zt([Br(new Z(Uint8Array.from([4]),$(r.x??"","base64url"),$(r.y??"","base64url")))],161)]).subarray()}function df(r){if(r==="P-256")return af;if(r==="P-384")return cf;if(r==="P-521")return ff;throw new ot(`Invalid curve ${r}`)}var Ie=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=Zs(this.jwk)),this._raw}toMultihash(){return Rt.digest(Yt(this))}toCID(){return dt.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:gt(this.raw,t.raw)}async verify(t,e){return zs(this.jwk,e,t)}};function Lr(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function pf(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ce(r,...t){if(!pf(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function $e(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Lr(r.outputLen),Lr(r.blockLen)}function Te(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function Ys(r,t){Ce(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}var ae=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function _r(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function It(r,t){return r<<32-t|r>>>t}var md=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function";function Ws(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Wt(r){return typeof r=="string"&&(r=Ws(r)),Ce(r),r}function zn(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Ce(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}var Ke=class{clone(){return this._cloneInto()}};function Ir(r){let t=n=>r().update(Wt(n)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}function Je(r=32){if(ae&&typeof ae.getRandomValues=="function")return ae.getRandomValues(new Uint8Array(r));if(ae&&typeof ae.randomBytes=="function")return Uint8Array.from(ae.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function mf(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(e>>o&s),a=Number(e&s),c=n?4:0,u=n?0:4;r.setUint32(t+c,i,n),r.setUint32(t+u,a,n)}function Xs(r,t,e){return r&t^~r&e}function $s(r,t,e){return r&t^r&e^t&e}var Ue=class extends Ke{constructor(t,e,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=_r(this.buffer)}update(t){Te(this);let{view:e,buffer:n,blockLen:o}=this;t=Wt(t);let s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=_r(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Te(this),Ys(t,this),this.finished=!0;let{buffer:e,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)e[l]=0;mf(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=_r(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,f[l],s)}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:e,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%e&&t.buffer.set(n),t}};var yf=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),$t=new Uint32Array(64),Gn=class extends Ue{constructor(t=32){super(64,t,8,!1),this.A=Xt[0]|0,this.B=Xt[1]|0,this.C=Xt[2]|0,this.D=Xt[3]|0,this.E=Xt[4]|0,this.F=Xt[5]|0,this.G=Xt[6]|0,this.H=Xt[7]|0}get(){let{A:t,B:e,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,e,n,o,s,i,a,c]}set(t,e,n,o,s,i,a,c){this.A=t|0,this.B=e|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,e){for(let l=0;l<16;l++,e+=4)$t[l]=t.getUint32(e,!1);for(let l=16;l<64;l++){let p=$t[l-15],S=$t[l-2],w=It(p,7)^It(p,18)^p>>>3,m=It(S,17)^It(S,19)^S>>>10;$t[l]=m+$t[l-7]+w+$t[l-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:f}=this;for(let l=0;l<64;l++){let p=It(a,6)^It(a,11)^It(a,25),S=f+p+Xs(a,c,u)+yf[l]+$t[l]|0,m=(It(n,2)^It(n,13)^It(n,22))+$s(n,o,s)|0;f=u,u=c,c=a,a=i+S|0,i=s,s=o,o=n,n=S+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,o,s,i,a,c,u,f)}roundClean(){$t.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ct=Ir(()=>new Gn);var Cr=BigInt(4294967295),jn=BigInt(32);function Js(r,t=!1){return t?{h:Number(r&Cr),l:Number(r>>jn&Cr)}:{h:Number(r>>jn&Cr)|0,l:Number(r&Cr)|0}}function xf(r,t=!1){let e=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let o=0;o<r.length;o++){let{h:s,l:i}=Js(r[o],t);[e[o],n[o]]=[s,i]}return[e,n]}var gf=(r,t)=>BigInt(r>>>0)<<jn|BigInt(t>>>0),bf=(r,t,e)=>r>>>e,wf=(r,t,e)=>r<<32-e|t>>>e,Ef=(r,t,e)=>r>>>e|t<<32-e,Sf=(r,t,e)=>r<<32-e|t>>>e,Af=(r,t,e)=>r<<64-e|t>>>e-32,vf=(r,t,e)=>r>>>e-32|t<<64-e,Bf=(r,t)=>t,Lf=(r,t)=>r,_f=(r,t,e)=>r<<e|t>>>32-e,If=(r,t,e)=>t<<e|r>>>32-e,Cf=(r,t,e)=>t<<e-32|r>>>64-e,Tf=(r,t,e)=>r<<e-32|t>>>64-e;function Kf(r,t,e,n){let o=(t>>>0)+(n>>>0);return{h:r+e+(o/2**32|0)|0,l:o|0}}var Uf=(r,t,e)=>(r>>>0)+(t>>>0)+(e>>>0),Rf=(r,t,e,n)=>t+e+n+(r/2**32|0)|0,Pf=(r,t,e,n)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0),Df=(r,t,e,n,o)=>t+e+n+o+(r/2**32|0)|0,Nf=(r,t,e,n,o)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0)+(o>>>0),kf=(r,t,e,n,o,s)=>t+e+n+o+s+(r/2**32|0)|0;var Mf={fromBig:Js,split:xf,toBig:gf,shrSH:bf,shrSL:wf,rotrSH:Ef,rotrSL:Sf,rotrBH:Af,rotrBL:vf,rotr32H:Bf,rotr32L:Lf,rotlSH:_f,rotlSL:If,rotlBH:Cf,rotlBL:Tf,add:Kf,add3L:Uf,add3H:Rf,add4L:Pf,add4H:Df,add5H:kf,add5L:Nf},F=Mf;var[Of,Hf]=F.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Jt=new Uint32Array(80),Qt=new Uint32Array(80),Zn=class extends Ue{constructor(t=64){super(128,t,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:t,Al:e,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:f,Fh:l,Fl:p,Gh:S,Gl:w,Hh:m,Hl:h}=this;return[t,e,n,o,s,i,a,c,u,f,l,p,S,w,m,h]}set(t,e,n,o,s,i,a,c,u,f,l,p,S,w,m,h){this.Ah=t|0,this.Al=e|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=f|0,this.Fh=l|0,this.Fl=p|0,this.Gh=S|0,this.Gl=w|0,this.Hh=m|0,this.Hl=h|0}process(t,e){for(let d=0;d<16;d++,e+=4)Jt[d]=t.getUint32(e),Qt[d]=t.getUint32(e+=4);for(let d=16;d<80;d++){let v=Jt[d-15]|0,R=Qt[d-15]|0,K=F.rotrSH(v,R,1)^F.rotrSH(v,R,8)^F.shrSH(v,R,7),I=F.rotrSL(v,R,1)^F.rotrSL(v,R,8)^F.shrSL(v,R,7),T=Jt[d-2]|0,B=Qt[d-2]|0,M=F.rotrSH(T,B,19)^F.rotrBH(T,B,61)^F.shrSH(T,B,6),P=F.rotrSL(T,B,19)^F.rotrBL(T,B,61)^F.shrSL(T,B,6),k=F.add4L(I,P,Qt[d-7],Qt[d-16]),O=F.add4H(k,K,M,Jt[d-7],Jt[d-16]);Jt[d]=O|0,Qt[d]=k|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:f,Eh:l,El:p,Fh:S,Fl:w,Gh:m,Gl:h,Hh:g,Hl:b}=this;for(let d=0;d<80;d++){let v=F.rotrSH(l,p,14)^F.rotrSH(l,p,18)^F.rotrBH(l,p,41),R=F.rotrSL(l,p,14)^F.rotrSL(l,p,18)^F.rotrBL(l,p,41),K=l&S^~l&m,I=p&w^~p&h,T=F.add5L(b,R,I,Hf[d],Qt[d]),B=F.add5H(T,g,v,K,Of[d],Jt[d]),M=T|0,P=F.rotrSH(n,o,28)^F.rotrBH(n,o,34)^F.rotrBH(n,o,39),k=F.rotrSL(n,o,28)^F.rotrBL(n,o,34)^F.rotrBL(n,o,39),O=n&s^n&a^s&a,A=o&i^o&c^i&c;g=m|0,b=h|0,m=S|0,h=w|0,S=l|0,w=p|0,{h:l,l:p}=F.add(u|0,f|0,B|0,M|0),u=a|0,f=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let L=F.add3L(M,k,A);n=F.add3H(L,B,P,O),o=L|0}({h:n,l:o}=F.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=F.add(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=F.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:f}=F.add(this.Dh|0,this.Dl|0,u|0,f|0),{h:l,l:p}=F.add(this.Eh|0,this.El|0,l|0,p|0),{h:S,l:w}=F.add(this.Fh|0,this.Fl|0,S|0,w|0),{h:m,l:h}=F.add(this.Gh|0,this.Gl|0,m|0,h|0),{h:g,l:b}=F.add(this.Hh|0,this.Hl|0,g|0,b|0),this.set(n,o,s,i,a,c,u,f,l,p,S,w,m,h,g,b)}roundClean(){Jt.fill(0),Qt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Yn=Ir(()=>new Zn);var Jn=BigInt(0),$n=BigInt(1);function ce(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Qn(r){if(!ce(r))throw new Error("Uint8Array expected")}function Pt(r,t){if(typeof t!="boolean")throw new Error(r+" boolean expected, got "+t)}function Qe(r){let t=r.toString(16);return t.length&1?"0"+t:t}function ei(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Jn:BigInt("0x"+r)}var ri=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",qf=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function te(r){if(Qn(r),ri)return r.toHex();let t="";for(let e=0;e<r.length;e++)t+=qf[r[e]];return t}var Ot={_0:48,_9:57,A:65,F:70,a:97,f:102};function Qs(r){if(r>=Ot._0&&r<=Ot._9)return r-Ot._0;if(r>=Ot.A&&r<=Ot.F)return r-(Ot.A-10);if(r>=Ot.a&&r<=Ot.f)return r-(Ot.a-10)}function tr(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(ri)return Uint8Array.fromHex(r);let t=r.length,e=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(e);for(let o=0,s=0;o<e;o++,s+=2){let i=Qs(r.charCodeAt(s)),a=Qs(r.charCodeAt(s+1));if(i===void 0||a===void 0){let c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function Ht(r){return ei(te(r))}function Dt(r){return Qn(r),ei(te(Uint8Array.from(r).reverse()))}function fe(r,t){return tr(r.toString(16).padStart(t*2,"0"))}function ee(r,t){return fe(r,t).reverse()}function J(r,t,e){let n;if(typeof t=="string")try{n=tr(t)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(ce(t))n=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof e=="number"&&o!==e)throw new Error(r+" of length "+e+" expected, got "+o);return n}function re(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Qn(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}var Wn=r=>typeof r=="bigint"&&Jn<=r;function Tr(r,t,e){return Wn(r)&&Wn(t)&&Wn(e)&&t<=r&&r<e}function pt(r,t,e,n){if(!Tr(t,e,n))throw new Error("expected valid "+r+": "+e+" <= n < "+n+", got "+t)}function ni(r){let t;for(t=0;r>Jn;r>>=$n,t+=1);return t}var ue=r=>($n<<BigInt(r))-$n,Xn=r=>new Uint8Array(r),ti=r=>Uint8Array.from(r);function oi(r,t,e){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let n=Xn(r),o=Xn(r),s=0,i=()=>{n.fill(1),o.fill(0),s=0},a=(...l)=>e(o,n,...l),c=(l=Xn(0))=>{o=a(ti([0]),l),n=a(),l.length!==0&&(o=a(ti([1]),l),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,p=[];for(;l<t;){n=a();let S=n.slice();p.push(S),l+=n.length}return re(...p)};return(l,p)=>{i(),c(l);let S;for(;!(S=p(u()));)c();return i(),S}}var Vf={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||ce(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Tt(r,t,e={}){let n=(o,s,i)=>{let a=Vf[s];if(typeof a!="function")throw new Error("invalid validator function");let c=r[o];if(!(i&&c===void 0)&&!a(c,r))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+c)};for(let[o,s]of Object.entries(t))n(o,s,!1);for(let[o,s]of Object.entries(e))n(o,s,!0);return r}function Re(r){let t=new WeakMap;return(e,...n)=>{let o=t.get(e);if(o!==void 0)return o;let s=r(e,...n);return t.set(e,s),s}}var at=BigInt(0),et=BigInt(1),he=BigInt(2),Ff=BigInt(3),to=BigInt(4),si=BigInt(5),ii=BigInt(8),zf=BigInt(9),Gf=BigInt(16);function j(r,t){let e=r%t;return e>=at?e:t+e}function eo(r,t,e){if(t<at)throw new Error("invalid exponent, negatives unsupported");if(e<=at)throw new Error("invalid modulus");if(e===et)return at;let n=et;for(;t>at;)t&et&&(n=n*r%e),r=r*r%e,t>>=et;return n}function Q(r,t,e){let n=r;for(;t-- >at;)n*=n,n%=e;return n}function Kr(r,t){if(r===at)throw new Error("invert: expected non-zero number");if(t<=at)throw new Error("invert: expected positive modulus, got "+t);let e=j(r,t),n=t,o=at,s=et,i=et,a=at;for(;e!==at;){let u=n/e,f=n%e,l=o-i*u,p=s-a*u;n=e,e=f,o=i,s=a,i=l,a=p}if(n!==et)throw new Error("invert: does not exist");return j(o,t)}function jf(r){let t=(r-et)/he,e,n,o;for(e=r-et,n=0;e%he===at;e/=he,n++);for(o=he;o<r&&eo(o,t,r)!==r-et;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){let i=(r+et)/to;return function(c,u){let f=c.pow(u,i);if(!c.eql(c.sqr(f),u))throw new Error("Cannot find square root");return f}}let s=(e+et)/he;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,f=a.pow(a.mul(a.ONE,o),e),l=a.pow(c,s),p=a.pow(c,e);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let S=1;for(let m=a.sqr(p);S<u&&!a.eql(m,a.ONE);S++)m=a.sqr(m);let w=a.pow(f,et<<BigInt(u-S-1));f=a.sqr(w),l=a.mul(l,w),p=a.mul(p,f),u=S}return l}}function Zf(r){if(r%to===Ff){let t=(r+et)/to;return function(n,o){let s=n.pow(o,t);if(!n.eql(n.sqr(s),o))throw new Error("Cannot find square root");return s}}if(r%ii===si){let t=(r-si)/ii;return function(n,o){let s=n.mul(o,he),i=n.pow(s,t),a=n.mul(o,i),c=n.mul(n.mul(a,he),i),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),o))throw new Error("Cannot find square root");return u}}return r%Gf,jf(r)}var ai=(r,t)=>(j(r,t)&et)===et,Yf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ro(r){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=Yf.reduce((n,o)=>(n[o]="function",n),t);return Tt(r,e)}function Wf(r,t,e){if(e<at)throw new Error("invalid exponent, negatives unsupported");if(e===at)return r.ONE;if(e===et)return t;let n=r.ONE,o=t;for(;e>at;)e&et&&(n=r.mul(n,o)),o=r.sqr(o),e>>=et;return n}function Xf(r,t){let e=new Array(t.length),n=t.reduce((s,i,a)=>r.is0(i)?s:(e[a]=s,r.mul(s,i)),r.ONE),o=r.inv(n);return t.reduceRight((s,i,a)=>r.is0(i)?s:(e[a]=r.mul(s,e[a]),r.mul(s,i)),o),e}function no(r,t){let e=t!==void 0?t:r.toString(2).length,n=Math.ceil(e/8);return{nBitLength:e,nByteLength:n}}function ne(r,t,e=!1,n={}){if(r<=at)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:o,nByteLength:s}=no(r,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let i,a=Object.freeze({ORDER:r,isLE:e,BITS:o,BYTES:s,MASK:ue(o),ZERO:at,ONE:et,create:c=>j(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return at<=c&&c<r},is0:c=>c===at,isOdd:c=>(c&et)===et,neg:c=>j(-c,r),eql:(c,u)=>c===u,sqr:c=>j(c*c,r),add:(c,u)=>j(c+u,r),sub:(c,u)=>j(c-u,r),mul:(c,u)=>j(c*u,r),pow:(c,u)=>Wf(a,c,u),div:(c,u)=>j(c*Kr(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Kr(c,r),sqrt:n.sqrt||(c=>(i||(i=Zf(r)),i(a,c))),invertBatch:c=>Xf(a,c),cmov:(c,u,f)=>f?u:c,toBytes:c=>e?ee(c,s):fe(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return e?Dt(c):Ht(c)}});return Object.freeze(a)}function ci(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let t=r.toString(2).length;return Math.ceil(t/8)}function oo(r){let t=ci(r);return t+Math.ceil(t/2)}function fi(r,t,e=!1){let n=r.length,o=ci(t),s=oo(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=e?Dt(r):Ht(r),a=j(i,t-et)+et;return e?ee(a,o):fe(a,o)}var ui=BigInt(0),fo=BigInt(1);function so(r,t){let e=t.negate();return r?e:t}function li(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function io(r,t){li(r,t);let e=Math.ceil(t/r)+1,n=2**(r-1),o=2**r,s=ue(r),i=BigInt(r);return{windows:e,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function hi(r,t,e){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=e,a=Number(r&o),c=r>>i;a>n&&(a-=s,c+=fo);let u=t*n,f=u+Math.abs(a)-1,l=a===0,p=a<0,S=t%2!==0;return{nextN:c,offset:f,isZero:l,isNeg:p,isNegF:S,offsetF:u}}function $f(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)})}function Jf(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)})}var ao=new WeakMap,di=new WeakMap;function co(r){return di.get(r)||1}function Ur(r,t){return{constTimeNegate:so,hasPrecomputes(e){return co(e)!==1},unsafeLadder(e,n,o=r.ZERO){let s=e;for(;n>ui;)n&fo&&(o=o.add(s)),s=s.double(),n>>=fo;return o},precomputeWindow(e,n){let{windows:o,windowSize:s}=io(n,t),i=[],a=e,c=a;for(let u=0;u<o;u++){c=a,i.push(c);for(let f=1;f<s;f++)c=c.add(a),i.push(c);a=c.double()}return i},wNAF(e,n,o){let s=r.ZERO,i=r.BASE,a=io(e,t);for(let c=0;c<a.windows;c++){let{nextN:u,offset:f,isZero:l,isNeg:p,isNegF:S,offsetF:w}=hi(o,c,a);o=u,l?i=i.add(so(S,n[w])):s=s.add(so(p,n[f]))}return{p:s,f:i}},wNAFUnsafe(e,n,o,s=r.ZERO){let i=io(e,t);for(let a=0;a<i.windows&&o!==ui;a++){let{nextN:c,offset:u,isZero:f,isNeg:l}=hi(o,a,i);if(o=c,!f){let p=n[u];s=s.add(l?p.negate():p)}}return s},getPrecomputes(e,n,o){let s=ao.get(n);return s||(s=this.precomputeWindow(n,e),e!==1&&ao.set(n,o(s))),s},wNAFCached(e,n,o){let s=co(e);return this.wNAF(s,this.getPrecomputes(s,e,o),n)},wNAFCachedUnsafe(e,n,o,s){let i=co(e);return i===1?this.unsafeLadder(e,n,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,o),n,s)},setWindowSize(e,n){li(n,t),di.set(e,n),ao.delete(e)}}}function Rr(r,t,e,n){if($f(e,r),Jf(n,t),e.length!==n.length)throw new Error("arrays of points and scalars must have equal length");let o=r.ZERO,s=ni(BigInt(e.length)),i=s>12?s-3:s>4?s-2:s?2:1,a=ue(i),c=new Array(Number(a)+1).fill(o),u=Math.floor((t.BITS-1)/i)*i,f=o;for(let l=u;l>=0;l-=i){c.fill(o);for(let S=0;S<n.length;S++){let w=n[S],m=Number(w>>BigInt(l)&a);c[m]=c[m].add(e[S])}let p=o;for(let S=c.length-1,w=o;S>0;S--)w=w.add(c[S]),p=p.add(w);if(f=f.add(p),l!==0)for(let S=0;S<i;S++)f=f.double()}return f}function er(r){return ro(r.Fp),Tt(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...no(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var Nt=BigInt(0),bt=BigInt(1),pi=BigInt(2),Qf=BigInt(8),tu={zip215:!0};function eu(r){let t=er(r);return Tt(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function mi(r){let t=eu(r),{Fp:e,n,prehash:o,hash:s,randomBytes:i,nByteLength:a,h:c}=t,u=pi<<BigInt(a*8)-bt,f=e.create,l=ne(t.n,t.nBitLength),p=t.uvRatio||((E,y)=>{try{return{isValid:!0,value:e.sqrt(E*e.inv(y))}}catch{return{isValid:!1,value:Nt}}}),S=t.adjustScalarBytes||(E=>E),w=t.domain||((E,y,x)=>{if(Pt("phflag",x),y.length||x)throw new Error("Contexts/pre-hash are not supported");return E});function m(E,y,x=!1){let _=x?bt:Nt;pt("coordinate "+E,y,_,u)}function h(E){if(!(E instanceof d))throw new Error("ExtendedPoint expected")}let g=Re((E,y)=>{let{ex:x,ey:_,ez:U}=E,D=E.is0();y==null&&(y=D?Qf:e.inv(U));let H=f(x*y),q=f(_*y),V=f(U*y);if(D)return{x:Nt,y:bt};if(V!==bt)throw new Error("invZ was invalid");return{x:H,y:q}}),b=Re(E=>{let{a:y,d:x}=t;if(E.is0())throw new Error("bad point: ZERO");let{ex:_,ey:U,ez:D,et:H}=E,q=f(_*_),V=f(U*U),z=f(D*D),X=f(z*z),W=f(q*y),tt=f(z*f(W+V)),wt=f(X+f(x*f(q*V)));if(tt!==wt)throw new Error("bad point: equation left != right (1)");let ct=f(_*U),lt=f(D*H);if(ct!==lt)throw new Error("bad point: equation left != right (2)");return!0});class d{constructor(y,x,_,U){m("x",y),m("y",x),m("z",_,!0),m("t",U),this.ex=y,this.ey=x,this.ez=_,this.et=U,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof d)throw new Error("extended point not allowed");let{x,y:_}=y||{};return m("x",x),m("y",_),new d(x,_,bt,f(x*_))}static normalizeZ(y){let x=e.invertBatch(y.map(_=>_.ez));return y.map((_,U)=>_.toAffine(x[U])).map(d.fromAffine)}static msm(y,x){return Rr(d,l,y,x)}_setWindowSize(y){K.setWindowSize(this,y)}assertValidity(){b(this)}equals(y){h(y);let{ex:x,ey:_,ez:U}=this,{ex:D,ey:H,ez:q}=y,V=f(x*q),z=f(D*U),X=f(_*q),W=f(H*U);return V===z&&X===W}is0(){return this.equals(d.ZERO)}negate(){return new d(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){let{a:y}=t,{ex:x,ey:_,ez:U}=this,D=f(x*x),H=f(_*_),q=f(pi*f(U*U)),V=f(y*D),z=x+_,X=f(f(z*z)-D-H),W=V+H,tt=W-q,wt=V-H,ct=f(X*tt),lt=f(W*wt),At=f(X*wt),Lt=f(tt*W);return new d(ct,lt,Lt,At)}add(y){h(y);let{a:x,d:_}=t,{ex:U,ey:D,ez:H,et:q}=this,{ex:V,ey:z,ez:X,et:W}=y,tt=f(U*V),wt=f(D*z),ct=f(q*_*W),lt=f(H*X),At=f((U+D)*(V+z)-tt-wt),Lt=lt-ct,ze=lt+ct,bs=f(wt-x*tt),ka=f(At*Lt),Ma=f(ze*bs),Oa=f(At*bs),Ha=f(Lt*ze);return new d(ka,Ma,Ha,Oa)}subtract(y){return this.add(y.negate())}wNAF(y){return K.wNAFCached(this,y,d.normalizeZ)}multiply(y){let x=y;pt("scalar",x,bt,n);let{p:_,f:U}=this.wNAF(x);return d.normalizeZ([_,U])[0]}multiplyUnsafe(y,x=d.ZERO){let _=y;return pt("scalar",_,Nt,n),_===Nt?R:this.is0()||_===bt?this:K.wNAFCachedUnsafe(this,_,d.normalizeZ,x)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return K.unsafeLadder(this,n).is0()}toAffine(y){return g(this,y)}clearCofactor(){let{h:y}=t;return y===bt?this:this.multiplyUnsafe(y)}static fromHex(y,x=!1){let{d:_,a:U}=t,D=e.BYTES;y=J("pointHex",y,D),Pt("zip215",x);let H=y.slice(),q=y[D-1];H[D-1]=q&-129;let V=Dt(H),z=x?u:e.ORDER;pt("pointHex.y",V,Nt,z);let X=f(V*V),W=f(X-bt),tt=f(_*X-U),{isValid:wt,value:ct}=p(W,tt);if(!wt)throw new Error("Point.fromHex: invalid y coordinate");let lt=(ct&bt)===bt,At=(q&128)!==0;if(!x&&ct===Nt&&At)throw new Error("Point.fromHex: x=0 and x_0=1");return At!==lt&&(ct=f(-ct)),d.fromAffine({x:ct,y:V})}static fromPrivateKey(y){let{scalar:x}=B(y);return v.multiply(x)}toRawBytes(){let{x:y,y:x}=this.toAffine(),_=ee(x,e.BYTES);return _[_.length-1]|=y&bt?128:0,_}toHex(){return te(this.toRawBytes())}}d.BASE=new d(t.Gx,t.Gy,bt,f(t.Gx*t.Gy)),d.ZERO=new d(Nt,bt,bt,Nt);let{BASE:v,ZERO:R}=d,K=Ur(d,a*8);function I(E){return j(E,n)}function T(E){return I(Dt(E))}function B(E){let y=e.BYTES;E=J("private key",E,y);let x=J("hashed private key",s(E),2*y),_=S(x.slice(0,y)),U=x.slice(y,2*y),D=T(_);return{head:_,prefix:U,scalar:D}}function M(E){let{head:y,prefix:x,scalar:_}=B(E),U=v.multiply(_),D=U.toRawBytes();return{head:y,prefix:x,scalar:_,point:U,pointBytes:D}}function P(E){return M(E).pointBytes}function k(E=new Uint8Array,...y){let x=re(...y);return T(s(w(x,J("context",E),!!o)))}function O(E,y,x={}){E=J("message",E),o&&(E=o(E));let{prefix:_,scalar:U,pointBytes:D}=M(y),H=k(x.context,_,E),q=v.multiply(H).toRawBytes(),V=k(x.context,q,D,E),z=I(H+V*U);pt("signature.s",z,Nt,n);let X=re(q,ee(z,e.BYTES));return J("result",X,e.BYTES*2)}let A=tu;function L(E,y,x,_=A){let{context:U,zip215:D}=_,H=e.BYTES;E=J("signature",E,2*H),y=J("message",y),x=J("publicKey",x,H),D!==void 0&&Pt("zip215",D),o&&(y=o(y));let q=Dt(E.slice(H,2*H)),V,z,X;try{V=d.fromHex(x,D),z=d.fromHex(E.slice(0,H),D),X=v.multiplyUnsafe(q)}catch{return!1}if(!D&&V.isSmallOrder())return!1;let W=k(U,z.toRawBytes(),V.toRawBytes(),y);return z.add(V.multiplyUnsafe(W)).subtract(X).clearCofactor().equals(d.ZERO)}return v._setWindowSize(8),{CURVE:t,getPublicKey:P,sign:O,verify:L,ExtendedPoint:d,utils:{getExtendedPublicKey:M,randomPrivateKey:()=>i(e.BYTES),precompute(E=8,y=d.BASE){return y._setWindowSize(E),y.multiply(BigInt(3)),y}}}}var Pe=BigInt(0),uo=BigInt(1);function ru(r){return Tt(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function yi(r){let t=ru(r),{P:e}=t,n=b=>j(b,e),o=t.montgomeryBits,s=Math.ceil(o/8),i=t.nByteLength,a=t.adjustScalarBytes||(b=>b),c=t.powPminus2||(b=>eo(b,e-BigInt(2),e));function u(b,d,v){let R=n(b*(d-v));return d=n(d-R),v=n(v+R),[d,v]}let f=(t.a-BigInt(2))/BigInt(4);function l(b,d){pt("u",b,Pe,e),pt("scalar",d,Pe,e);let v=d,R=b,K=uo,I=Pe,T=b,B=uo,M=Pe,P;for(let O=BigInt(o-1);O>=Pe;O--){let A=v>>O&uo;M^=A,P=u(M,K,T),K=P[0],T=P[1],P=u(M,I,B),I=P[0],B=P[1],M=A;let L=K+I,C=n(L*L),E=K-I,y=n(E*E),x=C-y,_=T+B,U=T-B,D=n(U*L),H=n(_*E),q=D+H,V=D-H;T=n(q*q),B=n(R*n(V*V)),K=n(C*y),I=n(x*(C+n(f*x)))}P=u(M,K,T),K=P[0],T=P[1],P=u(M,I,B),I=P[0],B=P[1];let k=c(I);return n(K*k)}function p(b){return ee(n(b),s)}function S(b){let d=J("u coordinate",b,s);return i===32&&(d[31]&=127),Dt(d)}function w(b){let d=J("scalar",b),v=d.length;if(v!==s&&v!==i){let R=""+s+" or "+i;throw new Error("invalid scalar, expected "+R+" bytes, got "+v)}return Dt(a(d))}function m(b,d){let v=S(d),R=w(b),K=l(v,R);if(K===Pe)throw new Error("invalid private or public key received");return p(K)}let h=p(t.Gu);function g(b){return m(b,h)}return{scalarMult:m,scalarMultBase:g,getSharedSecret:(b,d)=>m(b,d),getPublicKey:b=>g(b),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:h}}var rr=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),xi=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),tp=BigInt(0),nu=BigInt(1),gi=BigInt(2),ou=BigInt(3),su=BigInt(5),iu=BigInt(8);function wi(r){let t=BigInt(10),e=BigInt(20),n=BigInt(40),o=BigInt(80),s=rr,a=r*r%s*r%s,c=Q(a,gi,s)*a%s,u=Q(c,nu,s)*r%s,f=Q(u,su,s)*u%s,l=Q(f,t,s)*f%s,p=Q(l,e,s)*l%s,S=Q(p,n,s)*p%s,w=Q(S,o,s)*S%s,m=Q(w,o,s)*S%s,h=Q(m,t,s)*f%s;return{pow_p_5_8:Q(h,gi,s)*r%s,b2:a}}function Ei(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function au(r,t){let e=rr,n=j(t*t*t,e),o=j(n*n*t,e),s=wi(r*o).pow_p_5_8,i=j(r*n*s,e),a=j(t*i*i,e),c=i,u=j(i*xi,e),f=a===r,l=a===j(-r,e),p=a===j(-r*xi,e);return f&&(i=c),(l||p)&&(i=u),ai(i,e)&&(i=j(-i,e)),{isValid:f||l,value:i}}var bi=ne(rr,void 0,!0),cu={a:bi.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:bi,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:iu,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Yn,randomBytes:Je,adjustScalarBytes:Ei,uvRatio:au},Si=mi(cu);var nr=yi({P:rr,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{let t=rr,{pow_p_5_8:e,b2:n}=wi(r);return j(Q(e,ou,t)*n,t)},adjustScalarBytes:Ei,randomBytes:Je});var Pr=32;function Ai(r,t,e){return Si.verify(t,e instanceof Uint8Array?e:e.subarray(),r)}var Dr=class{type="Ed25519";raw;constructor(t){this.raw=ho(t,Pr)}toMultihash(){return Rt.digest(Yt(this))}toCID(){return dt.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:gt(this.raw,t.raw)}verify(t,e){return Ai(this.raw,e,t)}};function Bi(r){return r=ho(r,Pr),new Dr(r)}function ho(r,t){if(r=Uint8Array.from(r??[]),r.length!==t)throw new ot(`Key must be a Uint8Array of length ${t}, got ${r.length}`);return r}var uu=Math.pow(2,7),hu=Math.pow(2,14),lu=Math.pow(2,21),lo=Math.pow(2,28),po=Math.pow(2,35),mo=Math.pow(2,42),yo=Math.pow(2,49),Y=128,mt=127;function vt(r){if(r<uu)return 1;if(r<hu)return 2;if(r<lu)return 3;if(r<lo)return 4;if(r<po)return 5;if(r<mo)return 6;if(r<yo)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function xo(r,t,e=0){switch(vt(r)){case 8:t[e++]=r&255|Y,r/=128;case 7:t[e++]=r&255|Y,r/=128;case 6:t[e++]=r&255|Y,r/=128;case 5:t[e++]=r&255|Y,r/=128;case 4:t[e++]=r&255|Y,r>>>=7;case 3:t[e++]=r&255|Y,r>>>=7;case 2:t[e++]=r&255|Y,r>>>=7;case 1:{t[e++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return t}function du(r,t,e=0){switch(vt(r)){case 8:t.set(e++,r&255|Y),r/=128;case 7:t.set(e++,r&255|Y),r/=128;case 6:t.set(e++,r&255|Y),r/=128;case 5:t.set(e++,r&255|Y),r/=128;case 4:t.set(e++,r&255|Y),r>>>=7;case 3:t.set(e++,r&255|Y),r>>>=7;case 2:t.set(e++,r&255|Y),r>>>=7;case 1:{t.set(e++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return t}function go(r,t){let e=r[t],n=0;if(n+=e&mt,e<Y||(e=r[t+1],n+=(e&mt)<<7,e<Y)||(e=r[t+2],n+=(e&mt)<<14,e<Y)||(e=r[t+3],n+=(e&mt)<<21,e<Y)||(e=r[t+4],n+=(e&mt)*lo,e<Y)||(e=r[t+5],n+=(e&mt)*po,e<Y)||(e=r[t+6],n+=(e&mt)*mo,e<Y)||(e=r[t+7],n+=(e&mt)*yo,e<Y))return n;throw new RangeError("Could not decode varint")}function pu(r,t){let e=r.get(t),n=0;if(n+=e&mt,e<Y||(e=r.get(t+1),n+=(e&mt)<<7,e<Y)||(e=r.get(t+2),n+=(e&mt)<<14,e<Y)||(e=r.get(t+3),n+=(e&mt)<<21,e<Y)||(e=r.get(t+4),n+=(e&mt)*lo,e<Y)||(e=r.get(t+5),n+=(e&mt)*po,e<Y)||(e=r.get(t+6),n+=(e&mt)*mo,e<Y)||(e=r.get(t+7),n+=(e&mt)*yo,e<Y))return n;throw new RangeError("Could not decode varint")}function Nr(r,t,e=0){return t==null&&(t=it(vt(r))),t instanceof Uint8Array?xo(r,t,e):du(r,t,e)}function kr(r,t=0){return r instanceof Uint8Array?go(r,t):pu(r,t)}var wo=new Float32Array([-0]),oe=new Uint8Array(wo.buffer);function Li(r,t,e){wo[0]=r,t[e]=oe[0],t[e+1]=oe[1],t[e+2]=oe[2],t[e+3]=oe[3]}function _i(r,t){return oe[0]=r[t],oe[1]=r[t+1],oe[2]=r[t+2],oe[3]=r[t+3],wo[0]}var Eo=new Float64Array([-0]),yt=new Uint8Array(Eo.buffer);function Ii(r,t,e){Eo[0]=r,t[e]=yt[0],t[e+1]=yt[1],t[e+2]=yt[2],t[e+3]=yt[3],t[e+4]=yt[4],t[e+5]=yt[5],t[e+6]=yt[6],t[e+7]=yt[7]}function Ci(r,t){return yt[0]=r[t],yt[1]=r[t+1],yt[2]=r[t+2],yt[3]=r[t+3],yt[4]=r[t+4],yt[5]=r[t+5],yt[6]=r[t+6],yt[7]=r[t+7],Eo[0]}var mu=BigInt(Number.MAX_SAFE_INTEGER),yu=BigInt(Number.MIN_SAFE_INTEGER),Bt=class r{lo;hi;constructor(t,e){this.lo=t|0,this.hi=e|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(e+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(BigInt(e)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return le;if(t<mu&&t>yu)return this.fromNumber(Number(t));let e=t<0n;e&&(t=-t);let n=t>>32n,o=t-(n<<32n);return e&&(n=~n|0n,o=~o|0n,++o>Ti&&(o=0n,++n>Ti&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(t){if(t===0)return le;let e=t<0;e&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return e&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(t){return typeof t=="number"?r.fromNumber(t):typeof t=="bigint"?r.fromBigInt(t):typeof t=="string"?r.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new r(t.low>>>0,t.high>>>0):le}},le=new Bt(0,0);le.toBigInt=function(){return 0n};le.zzEncode=le.zzDecode=function(){return this};le.length=function(){return 1};var Ti=4294967296n;function Ki(r){let t=0,e=0;for(let n=0;n<r.length;++n)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:(e&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function Ui(r,t,e){if(e-t<1)return"";let o,s=[],i=0,a;for(;t<e;)a=r[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|r[t++]&63:a>239&&a<365?(a=((a&7)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(r[t++]&63)<<6|r[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function So(r,t,e){let n=e,o,s;for(let i=0;i<r.length;++i)o=r.charCodeAt(i),o<128?t[e++]=o:o<2048?(t[e++]=o>>6|192,t[e++]=o&63|128):(o&64512)===55296&&((s=r.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[e++]=o>>18|240,t[e++]=o>>12&63|128,t[e++]=o>>6&63|128,t[e++]=o&63|128):(t[e++]=o>>12|224,t[e++]=o>>6&63|128,t[e++]=o&63|128);return e-n}function Kt(r,t){return RangeError(`index out of range: ${r.pos} + ${t??1} > ${r.len}`)}function Mr(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}var Ao=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Kt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Kt(this,4);return Mr(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Kt(this,4);return Mr(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Kt(this,4);let t=_i(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Kt(this,4);let t=Ci(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw Kt(this,t);return this.pos+=t,e===n?new Uint8Array(0):this.buf.subarray(e,n)}string(){let t=this.bytes();return Ui(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Kt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Kt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new Bt(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Kt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Kt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Kt(this,8);let t=Mr(this.buf,this.pos+=4),e=Mr(this.buf,this.pos+=4);return new Bt(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=go(this.buf,this.pos);return this.pos+=vt(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function vo(r){return new Ao(r instanceof Uint8Array?r:r.subarray())}function de(r,t,e){let n=vo(r);return t.decode(n,void 0,e)}function Bo(r){let t=r??8192,e=t>>>1,n,o=t;return function(i){if(i<1||i>e)return it(i);o+i>t&&(n=it(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var pe=class{fn;len;next;val;constructor(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}};function Lo(){}var Io=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},xu=Bo();function gu(r){return globalThis.Buffer!=null?it(r):xu(r)}var sr=class{len;head;tail;states;constructor(){this.len=0,this.head=new pe(Lo,0,0),this.tail=this.head,this.states=null}_push(t,e,n){return this.tail=this.tail.next=new pe(t,e,n),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new Co((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Or,10,Bt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let e=Bt.fromBigInt(t);return this._push(Or,e.length(),e)}uint64Number(t){return this._push(xo,vt(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let e=Bt.fromBigInt(t).zzEncode();return this._push(Or,e.length(),e)}sint64Number(t){let e=Bt.fromNumber(t).zzEncode();return this._push(Or,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(_o,1,t?1:0)}fixed32(t){return this._push(or,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let e=Bt.fromBigInt(t);return this._push(or,4,e.lo)._push(or,4,e.hi)}fixed64Number(t){let e=Bt.fromNumber(t);return this._push(or,4,e.lo)._push(or,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Li,4,t)}double(t){return this._push(Ii,8,t)}bytes(t){let e=t.length>>>0;return e===0?this._push(_o,1,0):this.uint32(e)._push(wu,e,t)}string(t){let e=Ki(t);return e!==0?this.uint32(e)._push(So,e,t):this._push(_o,1,0)}fork(){return this.states=new Io(this),this.head=this.tail=new pe(Lo,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new pe(Lo,0,0),this.len=0),this}ldelim(){let t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=e,this.len+=n),this}finish(){let t=this.head.next,e=gu(this.len),n=0;for(;t!=null;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e}};function _o(r,t,e){t[e]=r&255}function bu(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}var Co=class extends pe{next;constructor(t,e){super(bu,t,e),this.next=void 0}};function Or(r,t,e){for(;r.hi!==0;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}function or(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function wu(r,t,e){t.set(r,e)}globalThis.Buffer!=null&&(sr.prototype.bytes=function(r){let t=r.length>>>0;return this.uint32(t),t>0&&this._push(Eu,t,r),this},sr.prototype.string=function(r){let t=globalThis.Buffer.byteLength(r);return this.uint32(t),t>0&&this._push(Su,t,r),this});function Eu(r,t,e){t.set(r,e)}function Su(r,t,e){r.length<40?So(r,t,e):t.utf8Write!=null?t.utf8Write(r,e):t.set($(r),e)}function To(){return new sr}function me(r,t){let e=To();return t.encode(r,e,{lengthDelimited:!1}),e.finish()}var De;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(De||(De={}));function Hr(r,t,e,n){return{name:r,type:t,encode:e,decode:n}}function Ko(r){function t(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let e=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return Hr("enum",De.VARINT,e,n)}function ye(r,t){return Hr("message",De.LENGTH_DELIMITED,r,t)}var ir=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var ft;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(ft||(ft={}));var Uo;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(Uo||(Uo={}));(function(r){r.codec=()=>Ko(Uo)})(ft||(ft={}));var qt;(function(r){let t;r.codec=()=>(t==null&&(t=ye((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),ft.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.Type=ft.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>me(e,r.codec()),r.decode=(e,n)=>de(e,r.codec(),n)})(qt||(qt={}));var Ro;(function(r){let t;r.codec=()=>(t==null&&(t=ye((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),ft.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.Type=ft.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>me(e,r.codec()),r.decode=(e,n)=>de(e,r.codec(),n)})(Ro||(Ro={}));var ar=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},qr=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Di={get(r=globalThis){let t=r.crypto;if(t?.subtle==null)throw new qr("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var se=Di;var fr={};Et(fr,{MAX_RSA_KEY_SIZE:()=>Po,generateRSAKeyPair:()=>Oi,jwkToJWKKeyPair:()=>Hi,jwkToPkcs1:()=>Lu,jwkToPkix:()=>Mo,jwkToRSAPrivateKey:()=>Vo,pkcs1MessageToJwk:()=>No,pkcs1MessageToRSAPrivateKey:()=>Oo,pkcs1ToJwk:()=>Bu,pkcs1ToRSAPrivateKey:()=>Mi,pkixMessageToJwk:()=>ko,pkixMessageToRSAPublicKey:()=>qo,pkixToJwk:()=>_u,pkixToRSAPublicKey:()=>Ho});var Ne=class{type="RSA";jwk;_raw;_multihash;constructor(t,e){this.jwk=t,this._multihash=e}get raw(){return this._raw==null&&(this._raw=fr.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return dt.createV1(114,this._multihash)}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:gt(this.raw,t.raw)}verify(t,e){return ki(this.jwk,e,t)}},cr=class{type="RSA";jwk;_raw;publicKey;constructor(t,e){this.jwk=t,this.publicKey=e}get raw(){return this._raw==null&&(this._raw=fr.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:gt(this.raw,t.raw)}sign(t){return Ni(this.jwk,t)}};var Po=8192,Do=18,Au=1062,vu=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Bu(r){let t=Mt(r);return No(t)}function No(r){return{n:G(r[1],"base64url"),e:G(r[2],"base64url"),d:G(r[3],"base64url"),p:G(r[4],"base64url"),q:G(r[5],"base64url"),dp:G(r[6],"base64url"),dq:G(r[7],"base64url"),qi:G(r[8],"base64url"),kty:"RSA"}}function Lu(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ot("JWK was missing components");return Zt([St(Uint8Array.from([0])),St($(r.n,"base64url")),St($(r.e,"base64url")),St($(r.d,"base64url")),St($(r.p,"base64url")),St($(r.q,"base64url")),St($(r.dp,"base64url")),St($(r.dq,"base64url")),St($(r.qi,"base64url"))]).subarray()}function _u(r){let t=Mt(r,{offset:0});return ko(t)}function ko(r){let t=Mt(r[1],{offset:0});return{kty:"RSA",n:G(t[0],"base64url"),e:G(t[1],"base64url")}}function Mo(r){if(r.n==null||r.e==null)throw new ot("JWK was missing components");return Zt([vu,Br(Zt([St($(r.n,"base64url")),St($(r.e,"base64url"))]))]).subarray()}function Mi(r){let t=Mt(r);return Oo(t)}function Oo(r){let t=No(r);return Vo(t)}function Ho(r,t){if(r.byteLength>=Au)throw new we("Key size is too large");let e=Mt(r,{offset:0});return qo(e,r,t)}function qo(r,t,e){let n=ko(r);if(e==null){let o=Ct(qt.encode({Type:ft.RSA,Data:t}));e=_t(Do,o)}return new Ne(n,e)}function Vo(r){if(Vi(r)>Po)throw new ot("Key size is too large");let t=Hi(r),e=Ct(qt.encode({Type:ft.RSA,Data:Mo(t.publicKey)})),n=_t(Do,e);return new cr(t.privateKey,new Ne(t.publicKey,n))}async function Oi(r){if(r>Po)throw new ot("Key size is too large");let t=await qi(r),e=Ct(qt.encode({Type:ft.RSA,Data:Mo(t.publicKey)})),n=_t(Do,e);return new cr(t.privateKey,new Ne(t.publicKey,n))}function Hi(r){if(r==null)throw new ot("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}async function qi(r){let t=await se.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),e=await Iu(t);return{privateKey:e[0],publicKey:e[1]}}async function Ni(r,t){let e=await se.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await se.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},e,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function ki(r,t,e){let n=await se.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return se.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,e instanceof Uint8Array?e:e.subarray())}async function Iu(r){if(r.privateKey==null||r.publicKey==null)throw new ot("Private and public key are required");return Promise.all([se.get().subtle.exportKey("jwk",r.privateKey),se.get().subtle.exportKey("jwk",r.publicKey)])}function Vi(r){if(r.kty!=="RSA")throw new ot("invalid key type");if(r.n==null)throw new ot("invalid key modulus");return $(r.n,"base64url").length*8}var Vr=class extends Ke{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,$e(t);let n=Wt(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return Te(this),this.iHash.update(t),this}digestInto(t){Te(this),Ce(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:e,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ke=(r,t,e)=>new Vr(r,t).update(e).digest();ke.create=(r,t)=>new Vr(r,t);function Fi(r){r.lowS!==void 0&&Pt("lowS",r.lowS),r.prehash!==void 0&&Pt("prehash",r.prehash)}function Cu(r){let t=er(r);Tt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:e,Fp:n,a:o}=t;if(e){if(!n.eql(o,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}var Fo=class extends Error{constructor(t=""){super(t)}},Vt={Err:Fo,_tlv:{encode:(r,t)=>{let{Err:e}=Vt;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length&1)throw new e("tlv.encode: unpadded data");let n=t.length/2,o=Qe(n);if(o.length/2&128)throw new e("tlv.encode: long form length too big");let s=n>127?Qe(o.length/2|128):"";return Qe(r)+s+o+t},decode(r,t){let{Err:e}=Vt,n=0;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length<2||t[n++]!==r)throw new e("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new e("tlv.decode(long): indefinite length not supported");if(c>4)throw new e("tlv.decode(long): byte length is too big");let u=t.subarray(n,n+c);if(u.length!==c)throw new e("tlv.decode: length bytes not complete");if(u[0]===0)throw new e("tlv.decode(long): zero leftmost byte");for(let f of u)i=i<<8|f;if(n+=c,i<128)throw new e("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new e("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(r){let{Err:t}=Vt;if(r<Ft)throw new t("integer: negative integers are not allowed");let e=Qe(r);if(Number.parseInt(e[0],16)&8&&(e="00"+e),e.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return e},decode(r){let{Err:t}=Vt;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Ht(r)}},toSig(r){let{Err:t,_int:e,_tlv:n}=Vt,o=J("signature",r),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:u,l:f}=n.decode(2,c);if(f.length)throw new t("invalid signature: left bytes after parsing");return{r:e.decode(a),s:e.decode(u)}},hexFromSig(r){let{_tlv:t,_int:e}=Vt,n=t.encode(2,e.encode(r.r)),o=t.encode(2,e.encode(r.s)),s=n+o;return t.encode(48,s)}},Ft=BigInt(0),ut=BigInt(1),L0=BigInt(2),zi=BigInt(3),_0=BigInt(4);function Tu(r){let t=Cu(r),{Fp:e}=t,n=ne(t.n,t.nBitLength),o=t.toBytes||((m,h,g)=>{let b=h.toAffine();return re(Uint8Array.from([4]),e.toBytes(b.x),e.toBytes(b.y))}),s=t.fromBytes||(m=>{let h=m.subarray(1),g=e.fromBytes(h.subarray(0,e.BYTES)),b=e.fromBytes(h.subarray(e.BYTES,2*e.BYTES));return{x:g,y:b}});function i(m){let{a:h,b:g}=t,b=e.sqr(m),d=e.mul(b,m);return e.add(e.add(d,e.mul(m,h)),g)}if(!e.eql(e.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return Tr(m,ut,t.n)}function c(m){let{allowedPrivateKeyLengths:h,nByteLength:g,wrapPrivateKey:b,n:d}=t;if(h&&typeof m!="bigint"){if(ce(m)&&(m=te(m)),typeof m!="string"||!h.includes(m.length))throw new Error("invalid private key");m=m.padStart(g*2,"0")}let v;try{v=typeof m=="bigint"?m:Ht(J("private key",m,g))}catch{throw new Error("invalid private key, expected hex or "+g+" bytes, got "+typeof m)}return b&&(v=j(v,d)),pt("private key",v,ut,d),v}function u(m){if(!(m instanceof p))throw new Error("ProjectivePoint expected")}let f=Re((m,h)=>{let{px:g,py:b,pz:d}=m;if(e.eql(d,e.ONE))return{x:g,y:b};let v=m.is0();h==null&&(h=v?e.ONE:e.inv(d));let R=e.mul(g,h),K=e.mul(b,h),I=e.mul(d,h);if(v)return{x:e.ZERO,y:e.ZERO};if(!e.eql(I,e.ONE))throw new Error("invZ was invalid");return{x:R,y:K}}),l=Re(m=>{if(m.is0()){if(t.allowInfinityPoint&&!e.is0(m.py))return;throw new Error("bad point: ZERO")}let{x:h,y:g}=m.toAffine();if(!e.isValid(h)||!e.isValid(g))throw new Error("bad point: x or y not FE");let b=e.sqr(g),d=i(h);if(!e.eql(b,d))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(h,g,b){if(h==null||!e.isValid(h))throw new Error("x required");if(g==null||!e.isValid(g))throw new Error("y required");if(b==null||!e.isValid(b))throw new Error("z required");this.px=h,this.py=g,this.pz=b,Object.freeze(this)}static fromAffine(h){let{x:g,y:b}=h||{};if(!h||!e.isValid(g)||!e.isValid(b))throw new Error("invalid affine point");if(h instanceof p)throw new Error("projective point not allowed");let d=v=>e.eql(v,e.ZERO);return d(g)&&d(b)?p.ZERO:new p(g,b,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){let g=e.invertBatch(h.map(b=>b.pz));return h.map((b,d)=>b.toAffine(g[d])).map(p.fromAffine)}static fromHex(h){let g=p.fromAffine(s(J("pointHex",h)));return g.assertValidity(),g}static fromPrivateKey(h){return p.BASE.multiply(c(h))}static msm(h,g){return Rr(p,n,h,g)}_setWindowSize(h){w.setWindowSize(this,h)}assertValidity(){l(this)}hasEvenY(){let{y:h}=this.toAffine();if(e.isOdd)return!e.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){u(h);let{px:g,py:b,pz:d}=this,{px:v,py:R,pz:K}=h,I=e.eql(e.mul(g,K),e.mul(v,d)),T=e.eql(e.mul(b,K),e.mul(R,d));return I&&T}negate(){return new p(this.px,e.neg(this.py),this.pz)}double(){let{a:h,b:g}=t,b=e.mul(g,zi),{px:d,py:v,pz:R}=this,K=e.ZERO,I=e.ZERO,T=e.ZERO,B=e.mul(d,d),M=e.mul(v,v),P=e.mul(R,R),k=e.mul(d,v);return k=e.add(k,k),T=e.mul(d,R),T=e.add(T,T),K=e.mul(h,T),I=e.mul(b,P),I=e.add(K,I),K=e.sub(M,I),I=e.add(M,I),I=e.mul(K,I),K=e.mul(k,K),T=e.mul(b,T),P=e.mul(h,P),k=e.sub(B,P),k=e.mul(h,k),k=e.add(k,T),T=e.add(B,B),B=e.add(T,B),B=e.add(B,P),B=e.mul(B,k),I=e.add(I,B),P=e.mul(v,R),P=e.add(P,P),B=e.mul(P,k),K=e.sub(K,B),T=e.mul(P,M),T=e.add(T,T),T=e.add(T,T),new p(K,I,T)}add(h){u(h);let{px:g,py:b,pz:d}=this,{px:v,py:R,pz:K}=h,I=e.ZERO,T=e.ZERO,B=e.ZERO,M=t.a,P=e.mul(t.b,zi),k=e.mul(g,v),O=e.mul(b,R),A=e.mul(d,K),L=e.add(g,b),C=e.add(v,R);L=e.mul(L,C),C=e.add(k,O),L=e.sub(L,C),C=e.add(g,d);let E=e.add(v,K);return C=e.mul(C,E),E=e.add(k,A),C=e.sub(C,E),E=e.add(b,d),I=e.add(R,K),E=e.mul(E,I),I=e.add(O,A),E=e.sub(E,I),B=e.mul(M,C),I=e.mul(P,A),B=e.add(I,B),I=e.sub(O,B),B=e.add(O,B),T=e.mul(I,B),O=e.add(k,k),O=e.add(O,k),A=e.mul(M,A),C=e.mul(P,C),O=e.add(O,A),A=e.sub(k,A),A=e.mul(M,A),C=e.add(C,A),k=e.mul(O,C),T=e.add(T,k),k=e.mul(E,C),I=e.mul(L,I),I=e.sub(I,k),k=e.mul(L,O),B=e.mul(E,B),B=e.add(B,k),new p(I,T,B)}subtract(h){return this.add(h.negate())}is0(){return this.equals(p.ZERO)}wNAF(h){return w.wNAFCached(this,h,p.normalizeZ)}multiplyUnsafe(h){let{endo:g,n:b}=t;pt("scalar",h,Ft,b);let d=p.ZERO;if(h===Ft)return d;if(this.is0()||h===ut)return this;if(!g||w.hasPrecomputes(this))return w.wNAFCachedUnsafe(this,h,p.normalizeZ);let{k1neg:v,k1:R,k2neg:K,k2:I}=g.splitScalar(h),T=d,B=d,M=this;for(;R>Ft||I>Ft;)R&ut&&(T=T.add(M)),I&ut&&(B=B.add(M)),M=M.double(),R>>=ut,I>>=ut;return v&&(T=T.negate()),K&&(B=B.negate()),B=new p(e.mul(B.px,g.beta),B.py,B.pz),T.add(B)}multiply(h){let{endo:g,n:b}=t;pt("scalar",h,ut,b);let d,v;if(g){let{k1neg:R,k1:K,k2neg:I,k2:T}=g.splitScalar(h),{p:B,f:M}=this.wNAF(K),{p:P,f:k}=this.wNAF(T);B=w.constTimeNegate(R,B),P=w.constTimeNegate(I,P),P=new p(e.mul(P.px,g.beta),P.py,P.pz),d=B.add(P),v=M.add(k)}else{let{p:R,f:K}=this.wNAF(h);d=R,v=K}return p.normalizeZ([d,v])[0]}multiplyAndAddUnsafe(h,g,b){let d=p.BASE,v=(K,I)=>I===Ft||I===ut||!K.equals(d)?K.multiplyUnsafe(I):K.multiply(I),R=v(this,g).add(v(h,b));return R.is0()?void 0:R}toAffine(h){return f(this,h)}isTorsionFree(){let{h,isTorsionFree:g}=t;if(h===ut)return!0;if(g)return g(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h,clearCofactor:g}=t;return h===ut?this:g?g(p,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return Pt("isCompressed",h),this.assertValidity(),o(p,this,h)}toHex(h=!0){return Pt("isCompressed",h),te(this.toRawBytes(h))}}p.BASE=new p(t.Gx,t.Gy,e.ONE),p.ZERO=new p(e.ZERO,e.ONE,e.ZERO);let S=t.nBitLength,w=Ur(p,t.endo?Math.ceil(S/2):S);return{CURVE:t,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:a}}function Ku(r){let t=er(r);return Tt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Gi(r){let t=Ku(r),{Fp:e,n}=t,o=e.BYTES+1,s=2*e.BYTES+1;function i(A){return j(A,n)}function a(A){return Kr(A,n)}let{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:l}=Tu({...t,toBytes(A,L,C){let E=L.toAffine(),y=e.toBytes(E.x),x=re;return Pt("isCompressed",C),C?x(Uint8Array.from([L.hasEvenY()?2:3]),y):x(Uint8Array.from([4]),y,e.toBytes(E.y))},fromBytes(A){let L=A.length,C=A[0],E=A.subarray(1);if(L===o&&(C===2||C===3)){let y=Ht(E);if(!Tr(y,ut,e.ORDER))throw new Error("Point is not on curve");let x=f(y),_;try{_=e.sqrt(x)}catch(H){let q=H instanceof Error?": "+H.message:"";throw new Error("Point is not on curve"+q)}let U=(_&ut)===ut;return(C&1)===1!==U&&(_=e.neg(_)),{x:y,y:_}}else if(L===s&&C===4){let y=e.fromBytes(E.subarray(0,e.BYTES)),x=e.fromBytes(E.subarray(e.BYTES,2*e.BYTES));return{x:y,y:x}}else{let y=o,x=s;throw new Error("invalid Point, expected length of "+y+", or uncompressed "+x+", got "+L)}}}),p=A=>te(fe(A,t.nByteLength));function S(A){let L=n>>ut;return A>L}function w(A){return S(A)?i(-A):A}let m=(A,L,C)=>Ht(A.slice(L,C));class h{constructor(L,C,E){pt("r",L,ut,n),pt("s",C,ut,n),this.r=L,this.s=C,E!=null&&(this.recovery=E),Object.freeze(this)}static fromCompact(L){let C=t.nByteLength;return L=J("compactSignature",L,C*2),new h(m(L,0,C),m(L,C,2*C))}static fromDER(L){let{r:C,s:E}=Vt.toSig(J("DER",L));return new h(C,E)}assertValidity(){}addRecoveryBit(L){return new h(this.r,this.s,L)}recoverPublicKey(L){let{r:C,s:E,recovery:y}=this,x=K(J("msgHash",L));if(y==null||![0,1,2,3].includes(y))throw new Error("recovery id invalid");let _=y===2||y===3?C+t.n:C;if(_>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");let U=(y&1)===0?"02":"03",D=c.fromHex(U+p(_)),H=a(_),q=i(-x*H),V=i(E*H),z=c.BASE.multiplyAndAddUnsafe(D,q,V);if(!z)throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return S(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,i(-this.s),this.recovery):this}toDERRawBytes(){return tr(this.toDERHex())}toDERHex(){return Vt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return tr(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}let g={isValidPrivateKey(A){try{return u(A),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let A=oo(t.n);return fi(t.randomBytes(A),t.n)},precompute(A=8,L=c.BASE){return L._setWindowSize(A),L.multiply(BigInt(3)),L}};function b(A,L=!0){return c.fromPrivateKey(A).toRawBytes(L)}function d(A){let L=ce(A),C=typeof A=="string",E=(L||C)&&A.length;return L?E===o||E===s:C?E===2*o||E===2*s:A instanceof c}function v(A,L,C=!0){if(d(A))throw new Error("first arg must be private key");if(!d(L))throw new Error("second arg must be public key");return c.fromHex(L).multiply(u(A)).toRawBytes(C)}let R=t.bits2int||function(A){if(A.length>8192)throw new Error("input is too large");let L=Ht(A),C=A.length*8-t.nBitLength;return C>0?L>>BigInt(C):L},K=t.bits2int_modN||function(A){return i(R(A))},I=ue(t.nBitLength);function T(A){return pt("num < 2^"+t.nBitLength,A,Ft,I),fe(A,t.nByteLength)}function B(A,L,C=M){if(["recovered","canonical"].some(W=>W in C))throw new Error("sign() legacy options not supported");let{hash:E,randomBytes:y}=t,{lowS:x,prehash:_,extraEntropy:U}=C;x==null&&(x=!0),A=J("msgHash",A),Fi(C),_&&(A=J("prehashed msgHash",E(A)));let D=K(A),H=u(L),q=[T(H),T(D)];if(U!=null&&U!==!1){let W=U===!0?y(e.BYTES):U;q.push(J("extraEntropy",W))}let V=re(...q),z=D;function X(W){let tt=R(W);if(!l(tt))return;let wt=a(tt),ct=c.BASE.multiply(tt).toAffine(),lt=i(ct.x);if(lt===Ft)return;let At=i(wt*i(z+lt*H));if(At===Ft)return;let Lt=(ct.x===lt?0:2)|Number(ct.y&ut),ze=At;return x&&S(At)&&(ze=w(At),Lt^=1),new h(lt,ze,Lt)}return{seed:V,k2sig:X}}let M={lowS:t.lowS,prehash:!1},P={lowS:t.lowS,prehash:!1};function k(A,L,C=M){let{seed:E,k2sig:y}=B(A,L,C),x=t;return oi(x.hash.outputLen,x.nByteLength,x.hmac)(E,y)}c.BASE._setWindowSize(8);function O(A,L,C,E=P){let y=A;L=J("msgHash",L),C=J("publicKey",C);let{lowS:x,prehash:_,format:U}=E;if(Fi(E),"strict"in E)throw new Error("options.strict was renamed to lowS");if(U!==void 0&&U!=="compact"&&U!=="der")throw new Error("format must be compact or der");let D=typeof y=="string"||ce(y),H=!D&&!U&&typeof y=="object"&&y!==null&&typeof y.r=="bigint"&&typeof y.s=="bigint";if(!D&&!H)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let q,V;try{if(H&&(q=new h(y.r,y.s)),D){try{U!=="compact"&&(q=h.fromDER(y))}catch(Lt){if(!(Lt instanceof Vt.Err))throw Lt}!q&&U!=="der"&&(q=h.fromCompact(y))}V=c.fromHex(C)}catch{return!1}if(!q||x&&q.hasHighS())return!1;_&&(L=t.hash(L));let{r:z,s:X}=q,W=K(L),tt=a(X),wt=i(W*tt),ct=i(z*tt),lt=c.BASE.multiplyAndAddUnsafe(V,wt,ct)?.toAffine();return lt?i(lt.x)===z:!1}return{CURVE:t,getPublicKey:b,getSharedSecret:v,sign:k,verify:O,ProjectivePoint:c,Signature:h,utils:g}}function Uu(r){return{hash:r,hmac:(t,...e)=>ke(r,t,zn(...e)),randomBytes:Je}}function ji(r,t){let e=n=>Gi({...r,...Uu(n)});return{...e(t),create:e}}var Wi=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Zi=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ru=BigInt(1),zo=BigInt(2),Yi=(r,t)=>(r+t/zo)/t;function Pu(r){let t=Wi,e=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=r*r*r%t,f=u*u*r%t,l=Q(f,e,t)*f%t,p=Q(l,e,t)*f%t,S=Q(p,zo,t)*u%t,w=Q(S,o,t)*S%t,m=Q(w,s,t)*w%t,h=Q(m,a,t)*m%t,g=Q(h,c,t)*h%t,b=Q(g,a,t)*m%t,d=Q(b,e,t)*f%t,v=Q(d,i,t)*w%t,R=Q(v,n,t)*u%t,K=Q(R,zo,t);if(!Go.eql(Go.sqr(K),r))throw new Error("Cannot find square root");return K}var Go=ne(Wi,void 0,void 0,{sqrt:Pu}),xe=ji({a:BigInt(0),b:BigInt(7),Fp:Go,n:Zi,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let t=Zi,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Ru*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=e,i=BigInt("0x100000000000000000000000000000000"),a=Yi(s*r,t),c=Yi(-n*r,t),u=j(r-a*e-c*o,t),f=j(-a*n-c*s,t),l=u>i,p=f>i;if(l&&(u=t-u),p&&(f=t-f),u>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:l,k1:u,k2neg:p,k2:f}}}},Ct),N0=BigInt(0);var k0=xe.ProjectivePoint;function Xi(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function $i(r,t,e){let n=Ar.digest(e instanceof Uint8Array?e:e.subarray());if(Xi(n))return n.then(({digest:o})=>xe.verify(t,o,r)).catch(o=>{throw new ar(String(o))});try{return xe.verify(t,n.digest,r)}catch(o){throw new ar(String(o))}}var Fr=class{type="secp256k1";raw;_key;constructor(t){this._key=Qi(t),this.raw=Ji(this._key)}toMultihash(){return Rt.digest(Yt(this))}toCID(){return dt.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:gt(this.raw,t.raw)}verify(t,e){return $i(this._key,e,t)}};function ta(r){return new Fr(r)}function Ji(r){return xe.ProjectivePoint.fromHex(r).toRawBytes(!0)}function Qi(r){try{return xe.ProjectivePoint.fromHex(r),r}catch(t){throw new we(String(t))}}function ur(r,t){let{Type:e,Data:n}=qt.decode(r),o=n??new Uint8Array;switch(e){case ft.RSA:return Ho(o,t);case ft.Ed25519:return Bi(o);case ft.secp256k1:return ta(o);case ft.ECDSA:return Gs(o);default:throw new Ee}}function Yt(r){return qt.encode({Type:ft[r.type],Data:r.raw})}var ea=Symbol.for("nodejs.util.inspect.custom"),Du=114,hr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[mn]=!0;toString(){return this.string==null&&(this.string=nt.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return dt.createV1(Du,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return gt(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return gt(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[ea](){return`PeerId(${this.toString()})`}},zr=class extends hr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Gr=class extends hr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},jr=class extends hr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Nu=2336,jo=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Rt.digest($(this.url))}[ea](){return`PeerId(${this.url})`}[mn]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return dt.createV1(Nu,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=G(t)),t.toString()===this.toString())}};function Zo(r){if(r.type==="Ed25519")return new Gr({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new jr({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new zr({multihash:r.toCID().multihash,publicKey:r});throw new Ee}var Zr=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Me=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Yr=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},lr=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function Wr(r){return r[Symbol.asyncIterator]!=null}function ra(r,t){if(r.byteLength>t)throw new Me("Message length too long")}var $r=r=>{let t=vt(r),e=it(t);return Nr(r,e),$r.bytes=t,e};$r.bytes=0;function na(r,t){t=t??{};let e=t.lengthEncoder??$r,n=t?.maxDataLength??4194304;function*o(s){ra(s,n);let i=e(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}return Wr(r)?async function*(){for await(let s of r)yield*o(s)}():function*(){for(let s of r)yield*o(s)}()}na.single=(r,t)=>{t=t??{};let e=t.lengthEncoder??$r,n=t?.maxDataLength??4194304;return ra(r,n),new Z(e(r.byteLength),r)};var ge;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ge||(ge={}));var Yo=r=>{let t=kr(r);return Yo.bytes=vt(t),t};Yo.bytes=0;function dr(r,t){let e=new Z,n=ge.LENGTH,o=-1,s=t?.lengthDecoder??Yo,i=t?.maxLengthLength??8,a=t?.maxDataLength??4194304;function*c(){for(;e.byteLength>0;){if(n===ge.LENGTH)try{if(o=s(e),o<0)throw new Zr("Invalid message length");if(o>a)throw new Me("Message length too long");let u=s.bytes;e.consume(u),t?.onLength!=null&&t.onLength(o),n=ge.DATA}catch(u){if(u instanceof RangeError){if(e.byteLength>i)throw new Yr("Message length length too long");break}throw u}if(n===ge.DATA){if(e.byteLength<o)break;let u=e.sublist(0,o);e.consume(o),t?.onData!=null&&t.onData(u),yield u,n=ge.LENGTH}}}return Wr(r)?async function*(){for await(let u of r)e.append(u),yield*c();if(e.byteLength>0)throw new lr("Unexpected end of input")}():function*(){for(let u of r)e.append(u),yield*c();if(e.byteLength>0)throw new lr("Unexpected end of input")}()}dr.fromReader=(r,t)=>{let e=1,n=async function*(){for(;;)try{let{done:s,value:i}=await r.next(e);if(s===!0)return;i!=null&&(yield i)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{e=1}}();return dr(n,{...t??{},onLength:s=>{e=s}})};function Ut(){let r={};return r.promise=new Promise((t,e)=>{r.resolve=t,r.reject=e}),r}var Jr=class extends Error{type;code;constructor(t,e,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=e??"ABORT_ERR"}};async function pr(r,t,e){if(t==null)return r;if(t.aborted)return r.catch(()=>{}),Promise.reject(new Jr(e?.errorMessage,e?.errorCode,e?.errorName));let n,o=new Jr(e?.errorMessage,e?.errorCode,e?.errorName);try{return await Promise.race([r,new Promise((s,i)=>{n=()=>{i(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var Wo=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=Ut(),this.haveNext=Ut()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ut(),t}async throw(t){return this.ended=!0,this.error=t,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return this.ended=!0,this.nextResult=t,this.haveNext.resolve(),t}async push(t,e){await this._push(t,e)}async end(t,e){t!=null?await this.throw(t):await this._push(void 0,e)}async _push(t,e){if(t!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ut(),await pr(this.readNext.promise,e?.signal,e)}};function Qr(){return new Wo}var tn=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function oa(r,t){let e=Qr();r.sink(e).catch(async i=>{await e.end(i)}),r.sink=async i=>{for await(let a of i)await e.push(a);await e.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new Z;return{read:async i=>{if(i?.signal?.throwIfAborted(),i?.bytes==null){let{done:c,value:u}=await pr(n.next(),i?.signal);return c===!0?null:u}for(;o.byteLength<i.bytes;){let{value:c,done:u}=await pr(n.next(),i?.signal);if(u===!0)throw new tn("unexpected end of input");o.append(c)}let a=o.sublist(0,i.bytes);return o.consume(i.bytes),a},write:async(i,a)=>{a?.signal?.throwIfAborted(),i instanceof Uint8Array?await e.push(i,a):await e.push(i.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let i=r.source;r.source=async function*(){t?.yieldBytes===!1?yield o:yield*o,yield*i}()}return r}}}var en=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},rn=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},nn=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function Xo(r,t={}){let e=oa(r,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=vt(t.maxDataLength));let n=t?.lengthDecoder??kr,o=t?.lengthEncoder??Nr;return{read:async i=>{let a=-1,c=new Z;for(;;){c.append(await e.read({...i,bytes:1}));try{a=n(c)}catch(u){if(u instanceof RangeError)continue;throw u}if(a<0)throw new en("Invalid message length");if(t?.maxLengthLength!=null&&c.byteLength>t.maxLengthLength)throw new nn("message length length too long");if(a>-1)break}if(t?.maxDataLength!=null&&a>t.maxDataLength)throw new rn("message length too long");return e.read({...i,bytes:a})},write:async(i,a)=>{await e.write(new Z(o(i.byteLength),i),a)},writeV:async(i,a)=>{let c=new Z(...i.flatMap(u=>[o(u.byteLength),u]));await e.write(c,a)},unwrap:()=>e.unwrap()}}function $o(){let r=Ut(),t=!1;return{sink:async e=>{if(t)throw new Error("already piped");t=!0,r.resolve(e)},source:async function*(){yield*await r.promise}()}}function sa(){let r=$o(),t=$o();return[{source:r.source,sink:t.sink},{source:t.source,sink:r.sink}]}var on=class{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},Oe=class{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new on(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let e=this.head;this.head=e.next=new on(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};var Jo=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}};function ia(r={}){return Mu(e=>{let n=e.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function Mu(r,t){t=t??{};let e=t.onEnd,n=new Oe,o,s,i,a=Ut(),c=async()=>{try{return n.isEmpty()?i?{done:!0}:await new Promise((h,g)=>{s=b=>{s=null,n.push(b);try{h(r(n))}catch(d){g(d)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Ut()})}},u=h=>s!=null?s(h):(n.push(h),o),f=h=>(n=new Oe,s!=null?s({error:h}):(n.push({error:h}),o)),l=h=>{if(i)return o;if(t?.objectMode!==!0&&h?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return u({done:!1,value:h})},p=h=>i?o:(i=!0,h!=null?f(h):u({done:!0})),S=()=>(n=new Oe,p(),{done:!0}),w=h=>(p(h),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:S,throw:w,push:l,end:p,get readableLength(){return n.size},onEmpty:async h=>{let g=h?.signal;if(g?.throwIfAborted(),n.isEmpty())return;let b,d;g!=null&&(b=new Promise((v,R)=>{d=()=>{R(new Jo)},g.addEventListener("abort",d)}));try{await Promise.race([a.promise,b])}finally{d!=null&&g!=null&&g?.removeEventListener("abort",d)}}},e==null)return o;let m=o;return o={[Symbol.asyncIterator](){return this},next(){return m.next()},throw(h){return m.throw(h),e!=null&&(e(h),e=void 0),{done:!0}},return(){return m.return(),e!=null&&(e(),e=void 0),{done:!0}},push:l,end(h){return m.end(h),e!=null&&(e(h),e=void 0),o},get readableLength(){return m.readableLength},onEmpty:h=>m.onEmpty(h)},o}function Ou(r){return r[Symbol.asyncIterator]!=null}async function Hu(r,t){try{await Promise.all(r.map(async e=>{for await(let n of e)await t.push(n)})),await t.end()}catch(e){await t.end(e).catch(()=>{})}}async function*qu(r){let t=Qr();Hu(r,t).catch(()=>{}),yield*t}function*Vu(r){for(let t of r)yield*t}function Fu(...r){let t=[];for(let e of r)Ou(e)||t.push(e);return t.length===r.length?Vu(t):qu(r)}var aa=Fu;function ca(r,...t){if(r==null)throw new Error("Empty pipeline");if(Qo(r)){let n=r;r=()=>n.source}else if(ua(r)||fa(r)){let n=r;r=()=>n}let e=[r,...t];if(e.length>1&&Qo(e[e.length-1])&&(e[e.length-1]=e[e.length-1].sink),e.length>2)for(let n=1;n<e.length-1;n++)Qo(e[n])&&(e[n]=Gu(e[n]));return zu(...e)}var zu=(...r)=>{let t;for(;r.length>0;)t=r.shift()(t);return t},fa=r=>r?.[Symbol.asyncIterator]!=null,ua=r=>r?.[Symbol.iterator]!=null,Qo=r=>r==null?!1:r.sink!=null&&r.source!=null,Gu=r=>t=>{let e=r.sink(t);if(e?.then!=null){let n=ia({objectMode:!0});e.then(()=>{n.end()},i=>{n.end(i)});let o,s=r.source;if(fa(s))o=async function*(){yield*s,n.end()};else if(ua(s))o=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return aa(n,o())}return r.source};var He=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function sn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function ts(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function xt(r,...t){if(!ts(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function es(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function ha(r,t){xt(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}function rs(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}var zt=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),la=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ju=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ju)throw new Error("Non little-endian hardware is not supported");function Zu(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function an(r){if(typeof r=="string")r=Zu(r);else if(ts(r))r=cn(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function da(r,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(r,t)}function pa(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}var ns=(r,t)=>{function e(n,...o){if(xt(n),r.nonceLength!==void 0){let f=o[0];if(!f)throw new Error("nonce / iv required");r.varSizeNonce?xt(f):xt(f,r.nonceLength)}let s=r.tagLength;s&&o[1]!==void 0&&xt(o[1]);let i=t(n,...o),a=(f,l)=>{if(l!==void 0){if(f!==2)throw new Error("cipher output not supported");xt(l)}},c=!1;return{encrypt(f,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,xt(f),a(i.encrypt.length,l),i.encrypt(f,l)},decrypt(f,l){if(xt(f),s&&f.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(i.decrypt.length,l),i.decrypt(f,l)}}}return Object.assign(e,r),e};function os(r,t,e=!0){if(t===void 0)return new Uint8Array(r);if(t.length!==r)throw new Error("invalid output length, expected "+r+", got: "+t.length);if(e&&!Yu(t))throw new Error("invalid output, must be aligned");return t}function ss(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(e>>o&s),a=Number(e&s),c=n?4:0,u=n?0:4;r.setUint32(t+c,i,n),r.setUint32(t+u,a,n)}function Yu(r){return r.byteOffset%4===0}function cn(r){return Uint8Array.from(r)}function Gt(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}var ya=r=>Uint8Array.from(r.split("").map(t=>t.charCodeAt(0))),Wu=ya("expand 16-byte k"),Xu=ya("expand 32-byte k"),$u=zt(Wu),Ju=zt(Xu);function N(r,t){return r<<t|r>>>32-t}function is(r){return r.byteOffset%4===0}var fn=64,Qu=16,xa=2**32-1,ma=new Uint32Array;function th(r,t,e,n,o,s,i,a){let c=o.length,u=new Uint8Array(fn),f=zt(u),l=is(o)&&is(s),p=l?zt(o):ma,S=l?zt(s):ma;for(let w=0;w<c;i++){if(r(t,e,n,f,i,a),i>=xa)throw new Error("arx: counter overflow");let m=Math.min(fn,c-w);if(l&&m===fn){let h=w/4;if(w%4!==0)throw new Error("arx: invalid block position");for(let g=0,b;g<Qu;g++)b=h+g,S[b]=p[b]^f[g];w+=fn;continue}for(let h=0,g;h<m;h++)g=w+h,s[g]=o[g]^u[h];w+=m}}function as(r,t){let{allowShortKeys:e,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=da({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof r!="function")throw new Error("core must be a function");return sn(o),sn(i),rs(s),rs(e),(a,c,u,f,l=0)=>{xt(a),xt(c),xt(u);let p=u.length;if(f===void 0&&(f=new Uint8Array(p)),xt(f),sn(l),l<0||l>=xa)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);let S=[],w=a.length,m,h;if(w===32)S.push(m=cn(a)),h=Ju;else if(w===16&&e)m=new Uint8Array(32),m.set(a),m.set(a,16),h=$u,S.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${w}`);is(c)||S.push(c=cn(c));let g=zt(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(h,g,zt(c.subarray(0,16)),g),c=c.subarray(16)}let b=16-o;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){let v=new Uint8Array(12);v.set(c,s?0:12-c.length),c=v,S.push(c)}let d=zt(c);return th(r,h,g,d,u,f,l,i),Gt(...S),f}}var ht=(r,t)=>r[t++]&255|(r[t++]&255)<<8,cs=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=an(t),xt(t,32);let e=ht(t,0),n=ht(t,2),o=ht(t,4),s=ht(t,6),i=ht(t,8),a=ht(t,10),c=ht(t,12),u=ht(t,14);this.r[0]=e&8191,this.r[1]=(e>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let f=0;f<8;f++)this.pad[f]=ht(t,16+2*f)}process(t,e,n=!1){let o=n?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],u=i[2],f=i[3],l=i[4],p=i[5],S=i[6],w=i[7],m=i[8],h=i[9],g=ht(t,e+0),b=ht(t,e+2),d=ht(t,e+4),v=ht(t,e+6),R=ht(t,e+8),K=ht(t,e+10),I=ht(t,e+12),T=ht(t,e+14),B=s[0]+(g&8191),M=s[1]+((g>>>13|b<<3)&8191),P=s[2]+((b>>>10|d<<6)&8191),k=s[3]+((d>>>7|v<<9)&8191),O=s[4]+((v>>>4|R<<12)&8191),A=s[5]+(R>>>1&8191),L=s[6]+((R>>>14|K<<2)&8191),C=s[7]+((K>>>11|I<<5)&8191),E=s[8]+((I>>>8|T<<8)&8191),y=s[9]+(T>>>5|o),x=0,_=x+B*a+M*(5*h)+P*(5*m)+k*(5*w)+O*(5*S);x=_>>>13,_&=8191,_+=A*(5*p)+L*(5*l)+C*(5*f)+E*(5*u)+y*(5*c),x+=_>>>13,_&=8191;let U=x+B*c+M*a+P*(5*h)+k*(5*m)+O*(5*w);x=U>>>13,U&=8191,U+=A*(5*S)+L*(5*p)+C*(5*l)+E*(5*f)+y*(5*u),x+=U>>>13,U&=8191;let D=x+B*u+M*c+P*a+k*(5*h)+O*(5*m);x=D>>>13,D&=8191,D+=A*(5*w)+L*(5*S)+C*(5*p)+E*(5*l)+y*(5*f),x+=D>>>13,D&=8191;let H=x+B*f+M*u+P*c+k*a+O*(5*h);x=H>>>13,H&=8191,H+=A*(5*m)+L*(5*w)+C*(5*S)+E*(5*p)+y*(5*l),x+=H>>>13,H&=8191;let q=x+B*l+M*f+P*u+k*c+O*a;x=q>>>13,q&=8191,q+=A*(5*h)+L*(5*m)+C*(5*w)+E*(5*S)+y*(5*p),x+=q>>>13,q&=8191;let V=x+B*p+M*l+P*f+k*u+O*c;x=V>>>13,V&=8191,V+=A*a+L*(5*h)+C*(5*m)+E*(5*w)+y*(5*S),x+=V>>>13,V&=8191;let z=x+B*S+M*p+P*l+k*f+O*u;x=z>>>13,z&=8191,z+=A*c+L*a+C*(5*h)+E*(5*m)+y*(5*w),x+=z>>>13,z&=8191;let X=x+B*w+M*S+P*p+k*l+O*f;x=X>>>13,X&=8191,X+=A*u+L*c+C*a+E*(5*h)+y*(5*m),x+=X>>>13,X&=8191;let W=x+B*m+M*w+P*S+k*p+O*l;x=W>>>13,W&=8191,W+=A*f+L*u+C*c+E*a+y*(5*h),x+=W>>>13,W&=8191;let tt=x+B*h+M*m+P*w+k*S+O*p;x=tt>>>13,tt&=8191,tt+=A*l+L*f+C*u+E*c+y*a,x+=tt>>>13,tt&=8191,x=(x<<2)+x|0,x=x+_|0,_=x&8191,x=x>>>13,U+=x,s[0]=_,s[1]=U,s[2]=D,s[3]=H,s[4]=q,s[5]=V,s[6]=z,s[7]=X,s[8]=W,s[9]=tt}finalize(){let{h:t,pad:e}=this,n=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=o,o=t[a]>>>13,t[a]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,n[0]=t[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+e[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+e[a]|0)+(i>>>16)|0,t[a]=i&65535;Gt(n)}update(t){es(this);let{buffer:e,blockLen:n}=this;t=an(t);let o=t.length;for(let s=0;s<o;){let i=Math.min(n-this.pos,o-s);if(i===n){for(;n<=o-s;s+=n)this.process(t,s);continue}e.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===n&&(this.process(e,0,!1),this.pos=0)}return this}destroy(){Gt(this.h,this.r,this.buffer,this.pad)}digestInto(t){es(this),ha(t,this),this.finished=!0;let{buffer:e,h:n}=this,{pos:o}=this;if(o){for(e[o++]=1;o<16;o++)e[o]=0;this.process(e,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=n[i]>>>0,t[s++]=n[i]>>>8;return t}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}};function eh(r){let t=(n,o)=>r(o).update(an(n)).digest(),e=r(new Uint8Array(32));return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=n=>r(n),t}var ga=eh(r=>new cs(r));function Ea(r,t,e,n,o,s=20){let i=r[0],a=r[1],c=r[2],u=r[3],f=t[0],l=t[1],p=t[2],S=t[3],w=t[4],m=t[5],h=t[6],g=t[7],b=o,d=e[0],v=e[1],R=e[2],K=i,I=a,T=c,B=u,M=f,P=l,k=p,O=S,A=w,L=m,C=h,E=g,y=b,x=d,_=v,U=R;for(let H=0;H<s;H+=2)K=K+M|0,y=N(y^K,16),A=A+y|0,M=N(M^A,12),K=K+M|0,y=N(y^K,8),A=A+y|0,M=N(M^A,7),I=I+P|0,x=N(x^I,16),L=L+x|0,P=N(P^L,12),I=I+P|0,x=N(x^I,8),L=L+x|0,P=N(P^L,7),T=T+k|0,_=N(_^T,16),C=C+_|0,k=N(k^C,12),T=T+k|0,_=N(_^T,8),C=C+_|0,k=N(k^C,7),B=B+O|0,U=N(U^B,16),E=E+U|0,O=N(O^E,12),B=B+O|0,U=N(U^B,8),E=E+U|0,O=N(O^E,7),K=K+P|0,U=N(U^K,16),C=C+U|0,P=N(P^C,12),K=K+P|0,U=N(U^K,8),C=C+U|0,P=N(P^C,7),I=I+k|0,y=N(y^I,16),E=E+y|0,k=N(k^E,12),I=I+k|0,y=N(y^I,8),E=E+y|0,k=N(k^E,7),T=T+O|0,x=N(x^T,16),A=A+x|0,O=N(O^A,12),T=T+O|0,x=N(x^T,8),A=A+x|0,O=N(O^A,7),B=B+M|0,_=N(_^B,16),L=L+_|0,M=N(M^L,12),B=B+M|0,_=N(_^B,8),L=L+_|0,M=N(M^L,7);let D=0;n[D++]=i+K|0,n[D++]=a+I|0,n[D++]=c+T|0,n[D++]=u+B|0,n[D++]=f+M|0,n[D++]=l+P|0,n[D++]=p+k|0,n[D++]=S+O|0,n[D++]=w+A|0,n[D++]=m+L|0,n[D++]=h+C|0,n[D++]=g+E|0,n[D++]=b+y|0,n[D++]=d+x|0,n[D++]=v+_|0,n[D++]=R+U|0}function rh(r,t,e,n){let o=r[0],s=r[1],i=r[2],a=r[3],c=t[0],u=t[1],f=t[2],l=t[3],p=t[4],S=t[5],w=t[6],m=t[7],h=e[0],g=e[1],b=e[2],d=e[3];for(let R=0;R<20;R+=2)o=o+c|0,h=N(h^o,16),p=p+h|0,c=N(c^p,12),o=o+c|0,h=N(h^o,8),p=p+h|0,c=N(c^p,7),s=s+u|0,g=N(g^s,16),S=S+g|0,u=N(u^S,12),s=s+u|0,g=N(g^s,8),S=S+g|0,u=N(u^S,7),i=i+f|0,b=N(b^i,16),w=w+b|0,f=N(f^w,12),i=i+f|0,b=N(b^i,8),w=w+b|0,f=N(f^w,7),a=a+l|0,d=N(d^a,16),m=m+d|0,l=N(l^m,12),a=a+l|0,d=N(d^a,8),m=m+d|0,l=N(l^m,7),o=o+u|0,d=N(d^o,16),w=w+d|0,u=N(u^w,12),o=o+u|0,d=N(d^o,8),w=w+d|0,u=N(u^w,7),s=s+f|0,h=N(h^s,16),m=m+h|0,f=N(f^m,12),s=s+f|0,h=N(h^s,8),m=m+h|0,f=N(f^m,7),i=i+l|0,g=N(g^i,16),p=p+g|0,l=N(l^p,12),i=i+l|0,g=N(g^i,8),p=p+g|0,l=N(l^p,7),a=a+c|0,b=N(b^a,16),S=S+b|0,c=N(c^S,12),a=a+c|0,b=N(b^a,8),S=S+b|0,c=N(c^S,7);let v=0;n[v++]=o,n[v++]=s,n[v++]=i,n[v++]=a,n[v++]=h,n[v++]=g,n[v++]=b,n[v++]=d}var nh=as(Ea,{counterRight:!1,counterLength:4,allowShortKeys:!1}),oh=as(Ea,{counterRight:!1,counterLength:8,extendNonceFn:rh,allowShortKeys:!1});var sh=new Uint8Array(16),ba=(r,t)=>{r.update(t);let e=t.length%16;e&&r.update(sh.subarray(e))},ih=new Uint8Array(32);function wa(r,t,e,n,o){let s=r(t,e,ih),i=ga.create(s);o&&ba(i,o),ba(i,n);let a=new Uint8Array(16),c=la(a);ss(c,0,BigInt(o?o.length:0),!0),ss(c,8,BigInt(n.length),!0),i.update(a);let u=i.digest();return Gt(s,a),u}var Sa=r=>(t,e,n)=>({encrypt(s,i){let a=s.length;i=os(a+16,i,!1),i.set(s);let c=i.subarray(0,-16);r(t,e,c,c,1);let u=wa(r,t,e,c,n);return i.set(u,a),Gt(u),i},decrypt(s,i){i=os(s.length-16,i,!1);let a=s.subarray(0,-16),c=s.subarray(-16),u=wa(r,t,e,a,n);if(!pa(c,u))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),r(t,e,i,i,1),Gt(u),i}}),fs=ns({blockSize:64,nonceLength:12,tagLength:16},Sa(nh)),Wy=ns({blockSize:64,nonceLength:24,tagLength:16},Sa(oh));function va(r,t,e){return $e(r),e===void 0&&(e=new Uint8Array(r.outputLen)),ke(r,Wt(e),Wt(t))}var us=new Uint8Array([0]),Aa=new Uint8Array;function Ba(r,t,e,n=32){if($e(r),Lr(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(n/r.outputLen);e===void 0&&(e=Aa);let s=new Uint8Array(o*r.outputLen),i=ke.create(r,t),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let u=0;u<o;u++)us[0]=u+1,a.update(u===0?Aa:c).update(e).update(us).digestInto(c),s.set(c,r.outputLen*u),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),us.fill(0),s.slice(0,n)}var un={hashSHA256(r){return Ct(r.subarray())},getHKDF(r,t){let e=va(Ct,t,r),o=Ba(Ct,e,void 0,96),s=o.subarray(0,32),i=o.subarray(32,64),a=o.subarray(64,96);return[s,i,a]},generateX25519KeyPair(){let r=nr.utils.randomPrivateKey();return{publicKey:nr.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:nr.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,t){return nr.getSharedSecret(r.subarray(),t.subarray())},chaCha20Poly1305Encrypt(r,t,e,n){return fs(n,t,e).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,t,e,n,o){return fs(n,t,e).decrypt(r.subarray(),o)}};var La=un;function _a(r){return{generateKeypair:r.generateX25519KeyPair,dh:(t,e)=>r.generateX25519SharedKey(t.privateKey,e).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var qe=r=>{let t=it(2);return t[0]=r>>8,t[1]=r,t};qe.bytes=2;var mr=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let t=0;return t+=r[0]<<8,t+=r[1],t}return r.getUint16(0)};mr.bytes=2;function Ia(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function hs(r,t){!t.enabled||!He||(r?(t(`LOCAL_STATIC_PUBLIC_KEY ${G(r.publicKey,"hex")}`),t(`LOCAL_STATIC_PRIVATE_KEY ${G(r.privateKey,"hex")}`)):t("Missing local static keys."))}function ls(r,t){!t.enabled||!He||(r?(t(`LOCAL_PUBLIC_EPHEMERAL_KEY ${G(r.publicKey,"hex")}`),t(`LOCAL_PRIVATE_EPHEMERAL_KEY ${G(r.privateKey,"hex")}`)):t("Missing local ephemeral keys."))}function Ca(r,t){!t.enabled||!He||t(r?`REMOTE_STATIC_PUBLIC_KEY ${G(r.subarray(),"hex")}`:"Missing remote static public key.")}function ds(r,t){!t.enabled||!He||t(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${G(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function ps(r,t,e){!e.enabled||!He||(e(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&G(r.k,"hex")}`),e(`CIPHER_STATE_2 ${t.n.getUint64()} ${t.k&&G(t.k,"hex")}`))}var Ve=class r extends Error{code;constructor(t="Invalid crypto exchange"){super(t),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"};var ah=0,ch=4294967295,fh="Cipherstate has reached maximum n, a new handshake must be performed",hn=class{n;bytes;view;constructor(t=ah){this.n=t,this.bytes=st(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,t,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>ch)throw new Error(fh)}};var be=st(0),Fe=class{k;n;crypto;constructor(t,e=void 0,n=0){this.crypto=t,this.k=e,this.n=new hn(n)}hasKey(){return!!this.k}encryptWithAd(t,e){if(!this.hasKey())return e;this.n.assertValue();let n=this.crypto.encrypt(e,this.n.getBytes(),t,this.k);return this.n.increment(),n}decryptWithAd(t,e,n){if(!this.hasKey())return e;this.n.assertValue();let o=this.crypto.decrypt(e,this.n.getBytes(),t,this.k,n);return this.n.increment(),o}},ms=class{cs;ck;h;crypto;constructor(t,e){this.crypto=t;let n=$(e,"utf-8");this.h=uh(t,n),this.ck=this.h,this.cs=new Fe(t)}mixKey(t){let[e,n]=this.crypto.hkdf(this.ck,t);this.ck=e,this.cs=new Fe(this.crypto,n)}mixHash(t){this.h=this.crypto.hash(new Z(this.h,t))}encryptAndHash(t){let e=this.cs.encryptWithAd(this.h,t);return this.mixHash(e),e}decryptAndHash(t){let e=this.cs.decryptWithAd(this.h,t);return this.mixHash(t),e}split(){let[t,e]=this.crypto.hkdf(this.ck,be);return[new Fe(this.crypto,t),new Fe(this.crypto,e)]}},ys=class{ss;s;e;rs;re;initiator;crypto;constructor(t){let{crypto:e,protocolName:n,prologue:o,initiator:s,s:i,e:a,rs:c,re:u}=t;this.crypto=e,this.ss=new ms(e,n),this.ss.mixHash(o),this.initiator=s,this.s=i,this.e=a,this.rs=c,this.re=u}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let t=this.crypto.generateKeypair();return this.ss.mixHash(t.publicKey),this.e=t,t.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(t,e=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(t.byteLength<e+32)throw new Error("message is not long enough");this.re=t.sublist(e,e+32),this.ss.mixHash(this.re)}readS(t,e=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(t.byteLength<e+n)throw new Error("message is not long enough");let o=t.sublist(e,e+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},yr=class extends ys{writeMessageA(t){return new Z(this.writeE(),this.ss.encryptAndHash(t))}writeMessageB(t){let e=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new Z(e,n,this.ss.encryptAndHash(t))}writeMessageC(t){let e=this.writeS();return this.writeSE(),new Z(e,this.ss.encryptAndHash(t))}readMessageA(t){try{return this.readE(t),this.ss.decryptAndHash(t.sublist(32))}catch(e){throw new Ve(`handshake stage 0 validation fail: ${e.message}`)}}readMessageB(t){try{this.readE(t),this.readEE();let e=this.readS(t,32);return this.readES(),this.ss.decryptAndHash(t.sublist(32+e))}catch(e){throw new Ve(`handshake stage 1 validation fail: ${e.message}`)}}readMessageC(t){try{let e=this.readS(t);return this.readSE(),this.ss.decryptAndHash(t.sublist(e))}catch(e){throw new Ve(`handshake stage 2 validation fail: ${e.message}`)}}};function uh(r,t){if(t.length<=32){let e=st(32);return e.set(t),e}else return r.hash(t)}var ln;(function(r){let t;r.codec=()=>(t==null&&(t=ye((e,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),e.webtransportCerthashes!=null)for(let s of e.webtransportCerthashes)n.uint32(10),n.bytes(s);if(e.streamMuxers!=null)for(let s of e.streamMuxers)n.uint32(18),n.string(s);o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={webtransportCerthashes:[],streamMuxers:[]},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&s.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new ir('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(e.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&s.streamMuxers.length===o.limits.streamMuxers)throw new ir('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(e.string());break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>me(e,r.codec()),r.decode=(e,n)=>de(e,r.codec(),n)})(ln||(ln={}));var xr;(function(r){let t;r.codec=()=>(t==null&&(t=ye((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.identityKey!=null&&e.identityKey.byteLength>0&&(n.uint32(10),n.bytes(e.identityKey)),e.identitySig!=null&&e.identitySig.byteLength>0&&(n.uint32(18),n.bytes(e.identitySig)),e.extensions!=null&&(n.uint32(34),ln.codec().encode(e.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={identityKey:st(0),identitySig:st(0)},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.identityKey=e.bytes();break}case 2:{s.identitySig=e.bytes();break}case 4:{s.extensions=ln.codec().decode(e,e.uint32(),{limits:o.limits?.extensions});break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>me(e,r.codec()),r.decode=(e,n)=>de(e,r.codec(),n)})(xr||(xr={}));async function xs(r,t,e){let n=await r.sign(Ta(t));return xr.encode({identityKey:Yt(r.publicKey),identitySig:n,extensions:e})}async function gs(r,t,e){try{let n=xr.decode(r),o=ur(n.identityKey);if(e?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${e}`);if(!t)throw new Error("Remote static does not exist");let s=Ta(t);if(!await o.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new br(n.message)}}function Ta(r){let t=$("noise-libp2p-static-key:");return r instanceof Uint8Array?ie([t,r],t.length+r.length):(r.prepend(t),r)}async function Ka(r,t){let{log:e,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:u}=r,f=await xs(s,a.publicKey,u),l=new yr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:i,s:a});hs(l.s,e),e.trace("Stage 0 - Initiator starting to send first message."),await n.write(l.writeMessageA(be),t),e.trace("Stage 0 - Initiator finished sending first message."),ls(l.e,e),e.trace("Stage 1 - Initiator waiting to receive first message from responder...");let p=l.readMessageB(await n.read(t));e.trace("Stage 1 - Initiator received the message."),ds(l.re,e),Ca(l.rs,e),e.trace("Initiator going to check remote's signature...");let S=await gs(p,l.rs,c);e.trace("All good with the signature!"),e.trace("Stage 2 - Initiator sending third handshake message."),await n.write(l.writeMessageC(f),t),e.trace("Stage 2 - Initiator sent message with signed payload.");let[w,m]=l.ss.split();return ps(w,m,e),{payload:S,encrypt:h=>w.encryptWithAd(be,h),decrypt:(h,g)=>m.decryptWithAd(be,h,g)}}async function Ua(r,t){let{log:e,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:u}=r,f=await xs(s,a.publicKey,u),l=new yr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:i,s:a});hs(l.s,e),e.trace("Stage 0 - Responder waiting to receive first message."),l.readMessageA(await n.read(t)),e.trace("Stage 0 - Responder received first message."),ds(l.re,e),e.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(l.writeMessageB(f),t),e.trace("Stage 1 - Responder sent the second handshake message with signed payload."),ls(l.e,e),e.trace("Stage 2 - Responder waiting for third handshake message...");let p=l.readMessageC(await n.read(t));e.trace("Stage 2 - Responder received the message, finished handshake.");let S=await gs(p,l.rs,c),[w,m]=l.ss.split();return ps(w,m,e),{payload:S,encrypt:h=>m.encryptWithAd(be,h),decrypt:(h,g)=>w.decryptWithAd(be,h,g)}}var Pa=16;function Da(r,t){return async function*(e){for await(let n of e)for(let o=0;o<n.length;o+=65519){let s=o+65519;s>n.length&&(s=n.length);let i;n instanceof Uint8Array?i=r.encrypt(n.subarray(o,s)):i=r.encrypt(n.sublist(o,s)),t?.encryptedPackets.increment(),yield new Z(qe(i.byteLength),i)}}}function Na(r,t){return async function*(e){for await(let n of e)for(let o=0;o<n.length;o+=65535){let s=o+65535;if(s>n.length&&(s=n.length),s-Pa<o)throw new Error("Invalid chunk");let i=n.sublist(o,s),a=n.subarray(o,s-Pa);try{let c=r.decrypt(i,a);t?.decryptedPackets.increment(),yield c}catch(c){throw t?.decryptErrors.increment(),c}}}}var dn=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(t,e={}){let{staticNoiseKey:n,extensions:o,crypto:s,prologueBytes:i}=e,{metrics:a}=t;this.components=t;let c=s??La;this.crypto=_a(c),this.extensions={webtransportCerthashes:[],...o},this.metrics=a?Ia(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=i??st(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[ws]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(t,e){let n=Xo(t,{lengthEncoder:qe,lengthDecoder:mr,maxDataLength:65535}),o=await this.performHandshakeInitiator(n,this.components.privateKey,e?.remotePeer?.publicKey,e),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=ur(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:Zo(i),streamMuxer:e?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}getStreamMuxer(t){if(t==null||t.length===0)return;let e=this.components.upgrader.getStreamMuxers();if(e!=null)for(let n of t){let o=e.get(n);if(o!=null)return o}if(t.length)throw new wr("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(t,e){let n=Xo(t,{lengthEncoder:qe,lengthDecoder:mr,maxDataLength:65535}),o=await this.performHandshakeResponder(n,this.components.privateKey,e?.remotePeer?.publicKey,e),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=ur(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:Zo(i),streamMuxer:e?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(t,e,n,o){let s,i=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await Ka({connection:t,privateKey:e,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:i,webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return s}async performHandshakeResponder(t,e,n,o){let s,i=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await Ua({connection:t,privateKey:e,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:i,webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return s}async createSecureConnection(t,e){let[n,o]=sa(),s=t.unwrap();return await ca(n,Da(e,this.metrics),s,i=>dr(i,{lengthDecoder:mr}),Na(e,this.metrics),n),o}};function hh(r={}){return t=>new dn(t,r)}return Ga(lh);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
return ChainsafeLibp2PNoise}));
